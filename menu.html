<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>In-Store Menu - Coffee Affair Bistro</title>
    
    <!-- We link to the SAME style.css file to keep the design consistent -->
    <link rel="stylesheet" href="style.css">

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins&display=swap" rel="stylesheet">

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
</head>
<body>

    <header class="site-header">
<div class="header-content">
    <h1 class="site-title"><a href="index.html" style="color: inherit; text-decoration: none;">The Coffee Affair Bistro</a></h1>
    <nav class="header-nav" style="margin-left: 40px;">
        <ul>
            <li class="dropdown">
                <a href="menu.html">MENU</a>
                <ul class="dropdown-menu">
                    <li><a href="menu.html#hot-coffee">Hot Coffee</a></li>
                    <li><a href="menu.html#iced-coffee">Non-Coffee</a></li>
                    <li><a href="menu.html#breakfast">Tea</a></li>
                    <li><a href="menu.html#lunch">Signature Drinks</a></li>
                    <li><a href="menu.html#wedges">Appetizers</a></li>
                    <li><a href="menu.html#donuts">Burger & Sandswich</a></li>
                    <li><a href="menu.html#baked-goods">Pasta</a></li>
                    <li><a href="menu.html#retail-packs">Desserts</a></li>
                    <li><a href="menu.html#whats-new">Signature Milkshakes</a></li>
                </ul>
            </li>
            <li><a href="locations.html">LOCATIONS</a></li>
            <li><a href="about.html">OUR HISTORY</a></li>
            <li><a href="#" id="timscaresph-link">#TCABISTROPH</a></li>
        </ul>
    </nav>
    <div class="header-actions">
        <a href="login.html" class="login-icon"><i class="fas fa-user"></i></a>
    </div>
</div>
    </header>

    <main class="menu-page-wrapper">
        <section class="menu-hero">

            <h1>In-store Menu</h1>
            <hr class="menu-divider">
        </section>

        <!-- Container for all menu categories -->
        <div class="menu-container">

    <!-- HOT COFFEE SECTION -->
    <section id="hot-coffee" class="menu-category-section">
        <div class="category-header">
            <h2 class="menu-category-title">Hot Coffee</h2>
        </div>
        <div class="product-grid-drinks">
            <div class="product-item-image">
                <img src="images/classic americano.jpg" alt="Classic Americano">
                <p class="product-caption">Classic Americano</p>
            </div>
            <div class="product-item-image">
                <img src="images/ice spanish latte.jpg" alt="Ice Spanish Latte">
                <p class="product-caption">Ice Spanish Latte</p>
            </div>
        </div>
    </section>

    <hr class="menu-divider">

    <!-- ICED COFFEE SECTION -->
    <section id="iced-coffee" class="menu-category-section">
        <div class="category-header">
            <h2 class="menu-category-title">Iced Coffee</h2>
        </div>
        <div class="product-grid-drinks">
            <div class="product-item-image">
                <img src="images/ice spanish latte.jpg" alt="Iced Creamy Latte">
                <p class="product-caption">Iced Creamy Latte</p>
            </div>
            <!-- Add more iced coffee items here -->
        </div>
    </section>

    <hr class="menu-divider">

    <!-- NON-COFFEE SECTION -->
    <section id="non-coffee" class="menu-category-section">
        <div class="category-header">
            <h2 class="menu-category-title">Non-Coffee</h2>
        </div>
        <div class="product-grid-drinks">
            <!-- Add non-coffee items here -->
        </div>
    </section>

    <hr class="menu-divider">

    <!-- TEA SECTION -->
    <section id="tea" class="menu-category-section">
        <div class="category-header">
            <h2 class="menu-category-title">Tea</h2>
        </div>
        <div class="product-grid-drinks">
            <!-- Add tea items here -->
        </div>
    </section>

    <hr class="menu-divider">

    <!-- SIGNATURE DRINKS SECTION -->
    <section id="signature-drinks" class="menu-category-section">
        <div class="category-header">
            <h2 class="menu-category-title">Signature Drinks</h2>
        </div>
        <div class="product-grid-drinks">
            <!-- Add signature drinks here -->
        </div>
    </section>

    <hr class="menu-divider">

    <!-- APPETIZERS SECTION -->
    <section id="appetizers" class="menu-category-section">
        <div class="category-header">
            <h2 class="menu-category-title">Appetizers</h2>
        </div>
        <div class="product-grid-food">
            <!-- Add appetizers here -->
        </div>
    </section>

    <hr class="menu-divider">

    <!-- BURGER & SANDWICH SECTION -->
    <section id="burger-sandwich" class="menu-category-section">
        <div class="category-header">
            <h2 class="menu-category-title">Burger & Sandwich</h2>
        </div>
        <div class="product-grid-food">
            <!-- Add burger & sandwich items here -->
        </div>
    </section>

    <hr class="menu-divider">

    <!-- PASTA SECTION -->
    <section id="pasta" class="menu-category-section">
        <div class="category-header">
            <h2 class="menu-category-title">Pasta</h2>
        </div>
        <div class="product-grid-food">
            <!-- Add pasta items here -->
        </div>
    </section>

    <hr class="menu-divider">

    <!-- DESSERTS SECTION -->
    <section id="desserts" class="menu-category-section">
        <div class="category-header">
            <h2 class="menu-category-title">Desserts</h2>
        </div>
        <div class="product-grid-food">
            <!-- Add desserts items here -->
        </div>
    </section>

    <hr class="menu-divider">

    <!-- FRUITY OPTIONS SECTION -->
    <section id="fruity-options" class="menu-category-section">
        <div class="category-header">
            <h2 class="menu-category-title">Fruity Options</h2>
        </div>
        <div class="product-grid-food">
            <!-- Add fruity options here -->
        </div>
    </section>

    <hr class="menu-divider">

    <!-- SIGNATURE MILKSHAKES SECTION -->
    <section id="signature-milkshakes" class="menu-category-section">
        <div class="category-header">
            <h2 class="menu-category-title">Signature Milkshakes</h2>
        </div>
        <div class="product-grid-food">
            <!-- Add signature milkshakes here -->
        </div>
    </section>

</div>
    </main>

    <!-- Floating Order Now Button -->
    <a href="login.html" class="floating-order-btn" id="orderNowBtn">
        <i class="fa-solid fa-store"></i> ORDER NOW
    </a>

    <!-- Admin Edit Button at Top -->
    <div id="adminEditButtonTopContainer" style="text-align:center; margin: 1rem 0; display:none;">
        <button id="adminEditButtonTop" style="background-color:#6f4e37; color:white; border:none; padding: 1rem 2rem; border-radius: 8px; cursor:pointer; font-size: 1.2rem; font-weight: 700;">
            Edit Menu
        </button>
    </div>

    <!-- Admin Edit Mode Toggle -->
    <div id="adminEditToggleContainer" style="text-align:center; margin: 1rem 0;">
        <button id="adminEditToggleBtn" style="background-color:#6f4e37; color:white; border:none; padding: 0.5rem 1rem; border-radius: 5px; cursor:pointer;">
            Enable Admin Edit Mode
        </button>
    </div>

    <!-- Admin Add Item Form (hidden by default) -->
    <div id="adminAddItemForm" style="display:none; max-width: 400px; margin: 0 auto 2rem auto; padding: 1rem; border: 1px solid #6f4e37; border-radius: 8px; background: #f9f4ef;">
        <h3 style="color:#6f4e37; text-align:center;">Add New Menu Item</h3>
        <form id="addItemForm">
            <div class="form-group" style="margin-bottom: 1rem;">
                <label for="newItemName" style="color:#6f4e37;">Name</label>
                <input type="text" id="newItemName" name="newItemName" required style="width: 100%; padding: 0.5rem; border: 1px solid #6f4e37; border-radius: 4px;">
            </div>
            <div class="form-group" style="margin-bottom: 1rem;">
                <label for="newItemImage" style="color:#6f4e37;">Image (JPG only)</label>
                <input type="file" id="newItemImage" name="newItemImage" accept=".jpg,.jpeg" required style="width: 100%;">
            </div>
            <button type="submit" style="background-color:#6f4e37; color:white; border:none; padding: 0.5rem 1rem; border-radius: 5px; cursor:pointer; width: 100%;">Add Item</button>
        </form>
    </div>

    <script>
        // Admin Edit Mode toggle logic
        const adminEditToggleBtn = document.getElementById('adminEditToggleBtn');
        const adminAddItemForm = document.getElementById('adminAddItemForm');
        const adminEditButtonTop = document.getElementById('adminEditButtonTop');
        const adminEditToggleContainer = document.getElementById('adminEditToggleContainer');
        const orderNowBtn = document.getElementById('orderNowBtn');
        let adminEditMode = false;

        // Check logged-in user role and adjust UI accordingly
        function adjustUIForUserRole() {
            const loggedInUser = JSON.parse(localStorage.getItem('bistroLoggedInUser'));
            if (loggedInUser && loggedInUser.role === 'admin') {
                // Show admin edit button at top and toggle container
                adminEditButtonTop.style.display = 'block';
                adminEditToggleContainer.style.display = 'block';
                // Hide order now button for admin
                if (orderNowBtn) orderNowBtn.style.display = 'none';
            } else {
                // Hide admin edit controls for non-admins
                adminEditButtonTop.style.display = 'none';
                adminEditToggleContainer.style.display = 'none';
                // Show order now button for customers or guests
                if (orderNowBtn) orderNowBtn.style.display = 'block';
                // Also hide add item form and reset toggle button text
                adminAddItemForm.style.display = 'none';
                adminEditToggleBtn.textContent = 'Enable Admin Edit Mode';
                adminEditMode = false;
                showDeleteButtons(false);
            }
        }

        // Call on page load
        adjustUIForUserRole();

        // Admin Edit Button at top click toggles admin edit mode
        adminEditButtonTop.addEventListener('click', () => {
            adminEditMode = !adminEditMode;
            if (adminEditMode) {
                adminAddItemForm.style.display = 'block';
                adminEditToggleBtn.textContent = 'Disable Admin Edit Mode';
                showDeleteButtons(true);
            } else {
                adminAddItemForm.style.display = 'none';
                adminEditToggleBtn.textContent = 'Enable Admin Edit Mode';
                showDeleteButtons(false);
            }
        });

        // Admin Edit Mode toggle button click
        adminEditToggleBtn.addEventListener('click', () => {
            adminEditMode = !adminEditMode;
            if (adminEditMode) {
                adminAddItemForm.style.display = 'block';
                adminEditToggleBtn.textContent = 'Disable Admin Edit Mode';
                showDeleteButtons(true);
            } else {
                adminAddItemForm.style.display = 'none';
                adminEditToggleBtn.textContent = 'Enable Admin Edit Mode';
                showDeleteButtons(false);
            }
        });

        // Show or hide delete buttons next to menu items
        function showDeleteButtons(show) {
            const deleteButtons = document.querySelectorAll('.admin-delete-btn');
            deleteButtons.forEach(btn => {
                btn.style.display = show ? 'inline-block' : 'none';
            });
        }

        // Add delete buttons next to each menu item dynamically
        function addDeleteButtons() {
            const productCaptions = document.querySelectorAll('.product-caption');
            productCaptions.forEach(caption => {
                // Avoid adding multiple buttons
                if (caption.querySelector('.admin-delete-btn')) return;

                const deleteBtn = document.createElement('button');
                deleteBtn.textContent = 'Delete';
                deleteBtn.className = 'admin-delete-btn';
                deleteBtn.style.marginLeft = '10px';
                deleteBtn.style.backgroundColor = '#a05a2c';
                deleteBtn.style.color = 'white';
                deleteBtn.style.border = 'none';
                deleteBtn.style.borderRadius = '4px';
                deleteBtn.style.padding = '2px 6px';
                deleteBtn.style.cursor = 'pointer';
                deleteBtn.style.display = 'none'; // Hidden by default

                deleteBtn.addEventListener('click', () => {
                    if (confirm(`Are you sure you want to delete "${caption.textContent}"?`)) {
                        deleteMenuItemByName(caption.textContent);
                    }
                });

                caption.appendChild(deleteBtn);
            });
        }

        // Delete menu item by name using data_manager.js update functions
        function deleteMenuItemByName(name) {
            // Get current menu from localStorage
            let menu = JSON.parse(localStorage.getItem('bistroMenu')) || [];
            // Find item by name
            const item = menu.find(i => i.name === name);
            if (!item) {
                alert('Item not found.');
                return;
            }
            // Remove item from menu array
            menu = menu.filter(i => i.id !== item.id);
            // Save updated menu
            localStorage.setItem('bistroMenu', JSON.stringify(menu));
            // Refresh page to update UI
            location.reload();
        }

        // Handle add item form submission
        document.getElementById('addItemForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const nameInput = document.getElementById('newItemName');
            const imageInput = document.getElementById('newItemImage');

            const name = nameInput.value.trim();
            const file = imageInput.files[0];

            if (!name) {
                alert('Please enter a name for the menu item.');
                return;
            }
            if (!file) {
                alert('Please select a JPG image file.');
                return;
            }
            if (!file.name.match(/\.(jpg|jpeg)$/i)) {
                alert('Only JPG images are allowed.');
                return;
            }

            // Read image file as data URL
            const reader = new FileReader();
            reader.onload = function(event) {
                const imageUrl = event.target.result;

                // Create new item object with default price and description empty
                const newItem = {
                    name: name,
                    description: '',
                    price: 0,
                    imageUrl: imageUrl,
                    category: 'Uncategorized'
                };

                // Add item to menu in localStorage
                let menu = JSON.parse(localStorage.getItem('bistroMenu')) || [];
                const newId = menu.length > 0 ? Math.max(...menu.map(i => i.id)) + 1 : 1;
                newItem.id = newId;
                menu.push(newItem);
                localStorage.setItem('bistroMenu', JSON.stringify(menu));

                // Clear form
                nameInput.value = '';
                imageInput.value = '';

                // Refresh page to show new item
                location.reload();
            };
            reader.readAsDataURL(file);
        });

        // Initialize delete buttons on page load
        document.addEventListener('DOMContentLoaded', () => {
            addDeleteButtons();
        });
    </script>

    <script>
        // When user clicks "Order Now" button, check if logged in
        document.getElementById('orderNowBtn').addEventListener('click', function(event) {
            // Check if user is logged in by checking localStorage for a logged-in user
            const loggedInUser = JSON.parse(localStorage.getItem('bistroLoggedInUser'));
            if (!loggedInUser) {
                // Not logged in, allow default link to login.html
                // After login, redirect to customer.html handled in login.html script
                return;
            } else {
                // User is logged in, redirect directly to customer.html
                event.preventDefault();
                window.location.href = 'customer.html';
            }
        });
    </script>

</body>
</html>