<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>☕ The Coffee Affair | Supervisor Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== ROOT VARIABLES & RESET ===== */
        :root {
            /* Modern Color Palette */
            --primary-dark: #1A120B;
            --primary-main: #3C2A21;
            --primary-light: #D5CEA3;
            --primary-accent: #E5BA73;
            
            --secondary-dark: #2C3639;
            --secondary-main: #3F4E4F;
            --secondary-light: #A27B5C;
            
            /* Functional Colors */
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --info: #3B82F6;
            
            /* Neutral Palette */
            --bg-primary: #F8F5F0;
            --bg-secondary: #FFFFFF;
            --bg-tertiary: #F3EFE7;
            
            --text-primary: #1A120B;
            --text-secondary: #6B7280;
            --text-tertiary: #9CA3AF;
            
            --border-light: #E5E7EB;
            --border-medium: #D1D5DB;
            
            /* Effects */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.08), 0 2px 4px -1px rgba(0, 0, 0, 0.04);
            --shadow-lg: 0 10px 25px -5px rgba(0, 0, 0, 0.08), 0 8px 10px -6px rgba(0, 0, 0, 0.04);
            --shadow-xl: 0 20px 40px -10px rgba(0, 0, 0, 0.12);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            
            --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #f9f7f2 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* ===== TYPOGRAPHY ===== */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            line-height: 1.2;
        }
        
        /* ===== LAYOUT & STRUCTURE ===== */
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar Navigation */
        .sidebar {
            width: 260px;
            background: var(--primary-dark);
            color: white;
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            z-index: 1000;
            transition: var(--transition-base);
            box-shadow: var(--shadow-lg);
        }
        
        .sidebar-header {
            padding: 0 1.5rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 1.5rem;
        }
        
        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .brand-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-accent), var(--secondary-light));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .brand-text {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .user-info {
            padding: 0 1.5rem 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-avatar {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-accent), var(--secondary-light));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.25rem;
            color: var(--primary-dark);
        }
        
        .user-details h4 {
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }
        
        .user-role {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 500;
        }
        
        .nav-menu {
            padding: 0 1.5rem;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            border-radius: var(--radius-md);
            transition: var(--transition-fast);
            margin-bottom: 0.5rem;
            cursor: pointer;
        }
        
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(5px);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, var(--primary-main), var(--secondary-main));
            color: white;
            box-shadow: 0 4px 12px rgba(60, 42, 33, 0.3);
        }
        
        .nav-item i {
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 2rem;
            transition: var(--transition-base);
        }
        
        /* Header */
        .main-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-light);
        }
        
        .header-title h1 {
            font-size: 1.75rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .header-title .date {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 400;
            margin-top: 0.25rem;
        }
        
        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .notification-bell {
            position: relative;
            width: 44px;
            height: 44px;
            background: white;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }
        
        .notification-bell:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-1px);
        }
        
        .notification-bell .badge {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 18px;
            height: 18px;
            background: var(--danger);
            border-radius: 50%;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition-base);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-accent), var(--secondary-light));
        }
        
        .stat-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary-accent));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-dark);
            font-size: 1.25rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-dark);
            line-height: 1;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        .stat-change {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        
        .stat-change.positive {
            color: var(--success);
        }
        
        .stat-change.negative {
            color: var(--danger);
        }
        
        /* Dashboard Grid - Original Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .dashboard-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.75rem;
            box-shadow: var(--shadow-md);
            transition: var(--transition-base);
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .dashboard-card:hover {
            box-shadow: var(--shadow-lg);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }
        
        .card-header h3 {
            font-size: 1.25rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .card-header h3 i {
            color: var(--primary-accent);
        }
        
        .card-content {
            flex: 1;
            min-height: 200px;
        }
        
        /* Task List */
        .task-list {
            list-style: none;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin-bottom: 0.75rem;
            transition: var(--transition-fast);
            cursor: pointer;
            border-left: 3px solid transparent;
        }
        
        .task-item:hover {
            transform: translateX(5px);
            background: white;
            box-shadow: var(--shadow-sm);
        }
        
        .task-item.completed {
            opacity: 0.7;
            border-left-color: var(--success);
        }
        
        .task-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-medium);
            border-radius: 6px;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }
        
        .task-item.completed .task-checkbox {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }
        
        .task-content {
            flex: 1;
        }
        
        .task-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .task-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-tertiary);
        }
        
        .task-status {
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            background: var(--warning);
            color: white;
            display: inline-block;
        }
        
        .task-item.completed .task-status {
            background: var(--success);
        }
        
        /* Equipment List */
        .equipment-list {
            list-style: none;
        }
        
        .equipment-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.875rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin-bottom: 0.75rem;
            transition: var(--transition-fast);
            cursor: pointer;
        }
        
        .equipment-item:hover {
            transform: translateX(5px);
            background: white;
            box-shadow: var(--shadow-sm);
        }
        
        .equipment-status {
            font-size: 0.8rem;
            font-weight: 600;
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            color: white;
        }
        
        .equipment-status.operational {
            background: var(--success);
        }
        
        .equipment-status.needs-cleaning {
            background: var(--warning);
        }
        
        .equipment-status.needs-maintenance {
            background: var(--danger);
        }
        
        /* Staff List */
        .staff-list {
            list-style: none;
        }
        
        .staff-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            margin-bottom: 0.75rem;
            transition: var(--transition-fast);
        }
        
        .staff-avatar {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary-accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--primary-dark);
            margin-right: 1rem;
            font-size: 1rem;
        }
        
        .staff-details {
            flex: 1;
        }
        
        .staff-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .staff-role {
            font-size: 0.85rem;
            color: var(--text-tertiary);
        }
        
        /* Feedback Items */
        .feedback-item {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 1.25rem;
            margin-bottom: 1rem;
            position: relative;
            border-left: 3px solid var(--primary-accent);
        }
        
        .feedback-rating {
            color: var(--warning);
            margin-bottom: 0.75rem;
        }
        
        .feedback-comment {
            font-style: italic;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }
        
        .feedback-date {
            font-size: 0.85rem;
            color: var(--text-tertiary);
            text-align: right;
        }
        
        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-md);
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition-fast);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-main), var(--secondary-main));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(60, 42, 33, 0.2);
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary-main);
            border: 1px solid var(--border-medium);
        }
        
        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary-main);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-info {
            background: var(--info);
            color: white;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
        }
        
        .reset-btn {
            background: var(--info);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.85rem;
            transition: var(--transition-fast);
        }
        
        .reset-btn:hover {
            background: var(--info);
            opacity: 0.9;
        }
        
        /* Completion Stats */
        .completion-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        /* Section Titles */
        .section-title {
            font-size: 1.1rem;
            color: var(--primary-dark);
            margin: 1.5rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Alerts */
        .alert {
            padding: 1rem 1.25rem;
            border-radius: var(--radius-md);
            margin: 1rem 0;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #FFF7ED, #FFEDD5);
            border-left: 3px solid var(--warning);
            color: #92400E;
        }
        
        .alert-success {
            background: linear-gradient(135deg, #D1FAE5, #ECFDF5);
            border-left: 3px solid var(--success);
            color: #065F46;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #DBEAFE, #EFF6FF);
            border-left: 3px solid var(--info);
            color: #1E40AF;
        }
        
        .alert-danger {
            background: linear-gradient(135deg, #FEE2E2, #FEF2F2);
            border-left: 3px solid var(--danger);
            color: #991B1B;
        }
        
        .alert-icon {
            margin-right: 0.75rem;
            font-size: 1.2rem;
        }
        
        /* Progress Bars */
        .progress-container {
            margin: 1rem 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .progress-bar {
            height: 8px;
            background: var(--border-light);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-accent), var(--secondary-light));
            border-radius: 4px;
            transition: width 0.6s ease;
        }
        
        /* Modal Styles - Enhanced */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 18, 11, 0.8);
            backdrop-filter: blur(5px);
            z-index: 2000;
            animation: modalFadeIn 0.3s ease;
            overflow-y: auto;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; backdrop-filter: blur(0); }
            to { opacity: 1; backdrop-filter: blur(5px); }
        }
        
        .modal-content {
            background: white;
            margin: 2rem auto;
            width: 90%;
            max-width: 1400px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes modalSlideIn {
            from { transform: translateY(30px) scale(0.95); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-main));
            color: white;
            padding: 1.75rem 2rem;
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
            font-size: 1.5rem;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 1.5rem;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        /* Tabs */
        .management-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            position: relative;
            transition: var(--transition-fast);
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            color: var(--primary-main);
        }
        
        .tab-btn.active {
            color: var(--primary-main);
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, var(--primary-accent), var(--secondary-light));
            border-radius: 3px 3px 0 0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 1.25rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-medium);
            border-radius: var(--radius-md);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: var(--transition-fast);
            background: white;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-accent);
            box-shadow: 0 0 0 3px rgba(229, 186, 115, 0.1);
        }
        
        .form-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }
        
        /* Table Styles */
        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }
        
        .table th {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-weight: 600;
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
        }
        
        .table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-light);
        }
        
        .table tr:hover {
            background: var(--bg-tertiary);
        }
        
        /* Badges */
        .badge {
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-success {
            background: var(--success);
            color: white;
        }
        
        .badge-warning {
            background: var(--warning);
            color: white;
        }
        
        .badge-danger {
            background: var(--danger);
            color: white;
        }
        
        .badge-info {
            background: var(--info);
            color: white;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .action-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: var(--transition-fast);
        }
        
        .action-btn.edit {
            background: var(--info);
            color: white;
        }
        
        .action-btn.delete {
            background: var(--danger);
            color: white;
        }
        
        .action-btn.view {
            background: var(--success);
            color: white;
        }
        
        /* Calendar Styles */
        .calendar-container {
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }
        
        .calendar {
            display: grid;
            gap: 1px;
            background: var(--border-light);
            border: 1px solid var(--border-light);
            width: 100%;
            min-width: 800px;
        }
        
        .calendar-header {
            background: var(--primary-main);
            color: white;
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .calendar-day {
            background: white;
            padding: 0.5rem;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: var(--transition-fast);
        }
        
        .calendar-day.header {
            background: var(--primary-main);
            color: white;
            font-weight: 600;
            justify-content: center;
        }
        
        .calendar-day.today {
            background: var(--bg-tertiary);
        }
        
        .employee-schedule {
            background: var(--info);
            color: white;
            padding: 0.4rem 0.6rem;
            border-radius: var(--radius-sm);
            margin-bottom: 0.2rem;
            font-size: 0.8rem;
            cursor: pointer;
            width: 100%;
            text-align: center;
            transition: var(--transition-fast);
        }
        
        .employee-schedule:hover {
            background: var(--info);
            opacity: 0.9;
        }
        
        /* Inventory Styles */
        .inventory-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-card-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
        }
        
        .stat-card-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }
        
        .inventory-coordination-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        .inventory-section {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            padding: 1.5rem;
        }
        
        .category-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: var(--success);
            color: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            display: none;
            z-index: 1001;
            animation: slideInRight 0.3s ease;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Loading States */
        .loading-shimmer {
            background: linear-gradient(90deg, 
                var(--bg-tertiary) 0%, 
                var(--bg-secondary) 50%, 
                var(--bg-tertiary) 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .sidebar {
                width: 80px;
            }
            
            .sidebar .brand-text,
            .sidebar .user-details,
            .sidebar .nav-item span {
                display: none;
            }
            
            .sidebar .brand {
                justify-content: center;
            }
            
            .sidebar .nav-item {
                justify-content: center;
                padding: 1rem;
            }
            
            .main-content {
                margin-left: 80px;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 1rem auto;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .inventory-stats {
                grid-template-columns: 1fr;
            }
            
            .management-tabs {
                flex-wrap: wrap;
            }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-accent);
        }
        
        /* Hover Effects */
        .hover-lift {
            transition: var(--transition-base);
        }
        
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        /* Pulse Animation for Important Elements */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Gradient Text */
        .gradient-text {
            background: linear-gradient(135deg, var(--primary-main), var(--secondary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="brand">
                    <div class="brand-icon">
                        <i class="fas fa-coffee"></i>
                    </div>
                    <span class="brand-text">Coffee Affair</span>
                </div>
            </div>
            
            <div class="user-info">
                <div class="user-avatar">SA</div>
                <div class="user-details">
                    <h4>Supervisor Admin</h4>
                    <span class="user-role">☕ Senior Supervisor</span>
                </div>
            </div>
            
            <nav class="nav-menu">
                <a href="#" class="nav-item active" onclick="showDashboard()">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="showInventory()">
                    <i class="fas fa-box-open"></i>
                    <span>Inventory</span>
                </a>
                <a href="#" class="nav-item" onclick="showCustomerService()">
                    <i class="fas fa-star"></i>
                    <span>Customer Service</span>
                </a>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Header -->
            <header class="main-header">
                <div class="header-title">
                    <h1 id="pageTitle">Supervisor Dashboard</h1>
                    <div class="date" id="currentDate"></div>
                </div>
                
                <div class="header-actions">
                    <button class="btn btn-secondary" id="syncDataBtn">
                        <i class="fas fa-sync-alt"></i> Sync Data
                    </button>
                    <button class="btn btn-primary" id="quickReportBtn">
                        <i class="fas fa-file-export"></i> Generate Report
                    </button>
                </div>
            </header>
            
            <!-- Dashboard Content -->
            <div id="dashboardContent">               
                <!-- Original Dashboard Grid -->
                <section class="dashboard-grid">
                    <!-- Operations Management Section -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-tasks"></i> Operations Management</h3>
                        </div>
                        <div class="card-content">
                            <h4 class="section-title"><i class="fas fa-clipboard-check"></i> Daily Checklist</h4>
                            <ul class="task-list" id="dailyChecklist">
                                <li class="task-item" data-task-id="1">
                                    <div class="task-checkbox"></div>
                                    <div class="task-content">
                                        <div class="task-title">Opening procedures completed</div>
                                        <span class="task-status">Pending</span>
                                    </div>
                                </li>
                                <li class="task-item" data-task-id="2">
                                    <div class="task-checkbox"></div>
                                    <div class="task-content">
                                        <div class="task-title">Quality control check</div>
                                        <span class="task-status">Pending</span>
                                    </div>
                                </li>
                                <li class="task-item" data-task-id="3">
                                    <div class="task-checkbox"></div>
                                    <div class="task-content">
                                        <div class="task-title">Equipment maintenance review</div>
                                        <span class="task-status">Pending</span>
                                    </div>
                                </li>
                                <li class="task-item" data-task-id="4">
                                    <div class="task-checkbox"></div>
                                    <div class="task-content">
                                        <div class="task-title">Inventory count</div>
                                        <span class="task-status">Pending</span>
                                    </div>
                                </li>
                                <li class="task-item" data-task-id="5">
                                    <div class="task-checkbox"></div>
                                    <div class="task-content">
                                        <div class="task-title">Closing procedures</div>
                                        <span class="task-status">Pending</span>
                                    </div>
                                </li>
                            </ul>
                            
                            <div class="completion-stats">
                                <span id="completionCount">0/5 tasks completed</span>
                                <span id="completionPercentage">0%</span>
                            </div>
                            
                            <button class="reset-btn" id="resetChecklistBtn">Reset Checklist</button>
                            
                            <h4 class="section-title"><i class="fas fa-cogs"></i> Equipment Status</h4>
                            <ul class="equipment-list" id="equipmentStatus">
                                <li class="equipment-item" data-equipment-id="1">
                                    <span>Espresso Machine</span>
                                    <span class="equipment-status operational">Operational</span>
                                </li>
                                <li class="equipment-item" data-equipment-id="2">
                                    <span>Coffee Grinder</span>
                                    <span class="equipment-status needs-cleaning">Needs cleaning</span>
                                </li>
                                <li class="equipment-item" data-equipment-id="3">
                                    <span>Refrigerator</span>
                                    <span class="equipment-status operational">Operational</span>
                                </li>
                                <li class="equipment-item" data-equipment-id="4">
                                    <span>POS System</span>
                                    <span class="equipment-status operational">Operational</span>
                                </li>
                            </ul>
                            
                            <button class="reset-btn" id="resetEquipmentBtn" style="margin-bottom: 1rem;">Reset Equipment Status</button>
                            
                            <button class="btn btn-primary" id="updateOperationsBtn" style="width: 100%;">
                                <i class="fas fa-sync"></i> Update Operations
                            </button>
                        </div>
                    </div>
                    
                    <!-- Staff Management Section -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-users"></i> Staff Management</h3>
                        </div>
                        <div class="card-content">
                            <h4 class="section-title"><i class="fas fa-clock"></i> Time Clock</h4>
                            <ul class="staff-list" id="timeClockDashboard">
                                <!-- Will be populated by JavaScript -->
                            </ul>

                            <h4 class="section-title"><i class="fas fa-calendar-day"></i> Today's Schedule</h4>
                            <ul class="staff-list" id="todayScheduleList">
                                <!-- Will be populated by JavaScript -->
                            </ul>
                            
                            <h4 class="section-title"><i class="fas fa-user-check"></i> Staff On Duty</h4>
                            <ul class="staff-list" id="staffOnDutyDashboard">
                                <!-- Will be populated by JavaScript -->
                            </ul>
                            
                            <button class="btn btn-primary" id="manageStaffBtn" style="width: 100%; margin-top: 1rem;">
                                <i class="fas fa-user-cog"></i> Manage Staff
                            </button>
                            <button class="btn btn-info" id="syncEmployeesBtn" style="width: 100%; margin-top: 0.5rem;">
                                <i class="fas fa-sync"></i> Sync with Admin System
                            </button>
                        </div>
                    </div>
                    
                    <!-- Customer Service Section -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3><i class="fas fa-star"></i> Customer Service</h3>
                        </div>
                        <div class="card-content">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                                <div class="stat-card" style="padding: 1rem; background: var(--bg-tertiary);">
                                    <div class="stat-value" id="avgRatingStat">0.0</div>
                                    <div class="stat-label">Avg. Rating</div>
                                </div>
                                <div class="stat-card" style="padding: 1rem; background: var(--bg-tertiary);">
                                    <div class="stat-value" id="pendingIssuesStat">0</div>
                                    <div class="stat-label">Pending Issues</div>
                                </div>
                            </div>
                            <h4 class="section-title"><i class="fas fa-comment"></i> Recent Feedback</h4>
                            <div id="feedbackList"></div>
                            <button class="btn btn-primary" id="viewFeedbackBtn" style="width: 100%; margin-top: 1rem;">
                                <i class="fas fa-eye"></i> View All Feedback
                            </button>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Staff Management Content (Hidden by default) -->
            <div id="staffManagementContent" style="display: none;">
                <h2>Staff Management</h2>
                <p>This section is under construction. Please use the "Manage Staff" button above.</p>
            </div>
        </main>
    </div>
    
    <!-- Staff Management Modal - Enhanced Version -->
    <div id="staffManagementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Staff Management System</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="management-tabs">
                    <button class="tab-btn active" data-tab="scheduling">Scheduling & Time Clock</button>
                    <button class="tab-btn" data-tab="tasks">Task Management</button>
                    <button class="tab-btn" data-tab="inventory">Inventory Coordination</button>
                </div>
                
                <!-- Scheduling & Time Clock Tab -->
                <div id="scheduling" class="tab-content active">
                    <h3 class="section-title"><i class="fas fa-calendar-alt"></i> Employee Scheduling</h3>
                    
                    <div class="calendar-container">
                        <div class="calendar" id="scheduleCalendar">
                            <!-- Calendar will be dynamically generated here -->
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem;">
                        <button class="btn btn-primary" id="createScheduleBtn">
                            <i class="fas fa-plus"></i> Create New Schedule
                        </button>
                        <button class="btn btn-info" id="copyScheduleBtn">
                            <i class="fas fa-copy"></i> Copy Previous Week
                        </button>
                        <button class="btn btn-success" id="syncWithAdminBtn">
                            <i class="fas fa-sync"></i> Sync with Admin System
                        </button>
                    </div>
                    
                    <h3 class="section-title"><i class="fas fa-clock"></i> Time Clock</h3>
                    <div style="margin-bottom: 1rem;">
                        <button class="btn btn-primary" id="createTimeClockBtn">
                            <i class="fas fa-plus"></i> Create New Entry
                        </button>
                    </div>
                    <table class="table" id="timeClockTable">
                        <thead>
                            <tr>
                                <th>Employee</th>
                                <th>Shift</th>
                                <th>Clock In</th>
                                <th>Clock Out</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Time clock entries will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Task Management Tab -->
                <div id="tasks" class="tab-content">
                    <h3 class="section-title"><i class="fas fa-tasks"></i> Task Management</h3>
                    <div style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem;">
                        <button class="btn btn-primary" id="createTaskBtn">
                            <i class="fas fa-plus"></i> Create New Task
                        </button>
                        <button class="btn btn-info" id="generateChecklistBtn">
                            <i class="fas fa-clipboard-list"></i> Generate Daily Checklist
                        </button>
                        <button class="btn btn-success" id="syncTasksWithAdminBtn">
                            <i class="fas fa-sync"></i> Sync Tasks with Admin
                        </button>
                    </div>
                    
                    <h3 class="section-title"><i class="fas fa-hourglass-half"></i> Open Tasks</h3>
                    <div id="openTasksContainer">
                        <!-- Open tasks will be populated by JavaScript -->
                    </div>
                    
                    <h3 class="section-title"><i class="fas fa-check-circle"></i> Completed Tasks</h3>
                    <div id="completedTasksContainer">
                        <!-- Completed tasks will be populated by JavaScript -->
                    </div>
                </div>
                
                <!-- Inventory Coordination Tab -->
                <div id="inventory" class="tab-content">
                    <div class="inventory-stats" id="inventoryStats">
                        <!-- Dynamic stats will be inserted here -->
                    </div>
                    
                    <div class="inventory-coordination-grid">
                        <div class="inventory-section">
                            <h3><i class="fas fa-boxes"></i> Current Inventory Status</h3>
                            
                            <div class="inventory-category">
                                <div class="category-title">Coffee & Beverages <button class="btn btn-info btn-sm" id="addCoffeeItem">+ Add</button></div>
                                <div id="coffeeInventoryList">
                                    <!-- Coffee inventory items will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="inventory-category">
                                <div class="category-title">Dairy & Alternatives <button class="btn btn-info btn-sm" id="addDairyItem">+ Add</button></div>
                                <div id="dairyInventoryList">
                                    <!-- Dairy inventory items will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="inventory-category">
                                <div class="category-title">Pastries & Food <button class="btn btn-info btn-sm" id="addFoodItem">+ Add</button></div>
                                <div id="foodInventoryList">
                                    <!-- Food inventory items will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div class="inventory-category">
                                <div class="category-title">Supplies & Packaging <button class="btn btn-info btn-sm" id="addSupplyItem">+ Add</button></div>
                                <div id="supplyInventoryList">
                                    <!-- Supply inventory items will be populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h3 class="section-title"><i class="fas fa-history"></i> Inventory Updates</h3>
                    <div style="margin-bottom: 1rem;">
                        <button class="btn btn-primary" id="createInventoryUpdateBtn">
                            <i class="fas fa-plus"></i> Create New Update
                        </button>
                    </div>
                    <table class="table" id="inventoryUpdatesTable">
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Updated By</th>
                                <th>Date</th>
                                <th>Change</th>
                                <th>New Level</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Inventory updates will be populated by JavaScript -->
                        </tbody>
                    </table>
                    
                    <h3 class="section-title"><i class="fas fa-clipboard-check"></i> Inventory Audits & History</h3>
                    
                    <div class="inventory-actions" style="display: flex; gap: 0.75rem; margin-bottom: 1.5rem;">
                        <button class="btn btn-primary" id="runAuditBtn">
                            <i class="fas fa-play"></i> Run New Audit
                        </button>
                        <button class="btn btn-info" id="exportAuditBtn">
                            <i class="fas fa-download"></i> Export Audit Report
                        </button>
                        <button class="btn btn-warning" id="clearOldAuditsBtn">
                            <i class="fas fa-trash"></i> Clear Old Audits
                        </button>
                    </div>

                    <table class="table" id="inventoryAuditsTable">
                        <thead>
                            <tr>
                                <th>Audit ID</th>
                                <th>Date</th>
                                <th>Auditor</th>
                                <th>Items Audited</th>
                                <th>Discrepancies</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Audit records will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Schedule Modal -->
    <div id="editScheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="editScheduleTitle">Edit Schedule</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group" id="employeeDisplayGroup">
                    <label for="employeeNameDisplay">Employee</label>
                    <input type="text" class="form-control" id="employeeNameDisplay" readonly>
                </div>
                
                <div class="form-group" id="employeeSelectGroup" style="display: none;">
                    <label for="employeeSelect">Employee</label>
                    <select class="form-control" id="employeeSelect">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                
                <div class="form-group" id="dayDisplayGroup">
                    <label for="dayDisplay">Day</label>
                    <input type="text" class="form-control" id="dayDisplay" readonly>
                </div>
                
                <div class="form-group" id="daySelectGroup" style="display: none;">
                    <label for="daySelect">Day</label>
                    <select class="form-control" id="daySelect">
                        <option value="MON">Monday</option>
                        <option value="TUE">Tuesday</option>
                        <option value="WED">Wednesday</option>
                        <option value="THU">Thursday</option>
                        <option value="FRI">Friday</option>
                        <option value="SAT">Saturday</option>
                        <option value="SUN">Sunday</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="shiftStart">Start Time</label>
                        <input type="time" class="form-control" id="shiftStart">
                    </div>
                    <div class="form-group">
                        <label for="shiftEnd">End Time</label>
                        <input type="time" class="form-control" id="shiftEnd">
                    </div>
                </div>
                <div style="display: flex; gap: 0.75rem;">
                    <button class="btn btn-primary" id="saveScheduleBtn">Save Schedule</button>
                    <button class="btn btn-danger" id="deleteScheduleBtn">Delete Schedule</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Time Clock Modal -->
    <div id="editTimeClockModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="editTimeClockTitle">Edit Time Clock</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group" id="timeClockEmployeeGroup">
                    <label for="timeClockEmployee">Employee</label>
                    <input type="text" class="form-control" id="timeClockEmployee" readonly>
                </div>
                
                <div class="form-group" id="timeClockEmployeeSelectGroup" style="display: none;">
                    <label for="timeClockEmployeeSelect">Employee</label>
                    <input type="text" class="form-control" id="timeClockEmployeeSelect" placeholder="Enter employee name">
                </div>
                
                <div class="form-group">
                    <label for="timeClockShift">Shift</label>
                    <input type="text" class="form-control" id="timeClockShift">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="timeClockIn">Clock In</label>
                        <input type="time" class="form-control" id="timeClockIn">
                    </div>
                    <div class="form-group">
                        <label for="timeClockOut">Clock Out</label>
                        <input type="time" class="form-control" id="timeClockOut">
                    </div>
                </div>
                
                <div style="display: flex; gap: 0.75rem;">
                    <button class="btn btn-primary" id="saveTimeClockBtn">Save Time Clock</button>
                    <button class="btn btn-danger" id="deleteTimeClockBtn">Delete Entry</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Edit Task Modal -->
    <div id="editTaskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="editTaskTitle">Edit Task</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="taskTitleInput">Task Title</label>
                    <input type="text" class="form-control" id="taskTitleInput">
                </div>
                <div class="form-group">
                    <label for="taskAssignee">Assigned To</label>
                    <select class="form-control" id="taskAssignee">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="taskDueDate">Due Date</label>
                        <input type="date" class="form-control" id="taskDueDate">
                    </div>
                    <div class="form-group">
                        <label for="taskDueTime">Due Time</label>
                        <input type="time" class="form-control" id="taskDueTime">
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="taskCompleted"> Mark as completed
                    </label>
                </div>
                <div style="display: flex; gap: 0.75rem;">
                    <button class="btn btn-primary" id="saveTaskBtn">Save Task</button>
                    <button class="btn btn-danger" id="deleteTaskBtn">Delete Task</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Inventory Modal -->
    <div id="editInventoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="editInventoryTitle">Edit Inventory</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="inventoryItem">Item Name</label>
                    <input type="text" class="form-control" id="inventoryItem">
                </div>
                <div class="form-group">
                    <label for="inventoryCategory">Category</label>
                    <select class="form-control" id="inventoryCategory">
                        <option value="coffee">Coffee & Beverages</option>
                        <option value="dairy">Dairy & Alternatives</option>
                        <option value="food">Pastries & Food</option>
                        <option value="supplies">Supplies & Packaging</option>
                    </select>
                </div>
                
                <div class="form-group" id="unitSelectionGroup">
                    <label for="inventoryUnit">Unit of Measurement</label>
                    <select class="form-control" id="inventoryUnit">
                        <!-- Options will be populated based on category -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="inventoryQuantity">Current Quantity</label>
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <input type="number" class="form-control" id="inventoryQuantity" step="0.01" min="0">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <span class="form-control" id="unitDisplay" style="background: var(--bg-tertiary); text-align: center;">kg</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="inventoryMaximumStock">Maximum Stock Level</label>
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <input type="number" class="form-control" id="inventoryMaximumStock" step="0.01" min="0" placeholder="Set maximum stock level">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <span class="form-control" id="maxStockUnitDisplay" style="background: var(--bg-tertiary); text-align: center;">kg</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="inventoryThreshold">Reorder Threshold</label>
                    <div class="form-row">
                        <div class="form-group" style="flex: 2;">
                            <input type="number" class="form-control" id="inventoryThreshold" step="0.01" min="0" placeholder="Minimum quantity for reorder">
                        </div>
                        <div class="form-group" style="flex: 1;">
                            <span class="form-control" id="thresholdUnitDisplay" style="background: var(--bg-tertiary); text-align: center;">kg</span>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Current Stock Level Status</label>
                    <div id="stockLevelStatusDisplay" style="padding: 0.75rem; border-radius: var(--radius-md); background: var(--bg-tertiary); text-align: center; font-weight: 600;">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                
                <div style="display: flex; gap: 0.75rem;">
                    <button class="btn btn-primary" id="saveInventoryBtn">Save Inventory</button>
                    <button class="btn btn-danger" id="deleteInventoryBtn">Delete Inventory</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Inventory Audit Modal -->
    <div id="inventoryAuditModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="inventoryAuditTitle">Inventory Audit</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group">
                        <label for="auditDate">Audit Date</label>
                        <input type="date" class="form-control" id="auditDate">
                    </div>
                    <div class="form-group">
                        <label for="auditTime">Audit Time</label>
                        <input type="time" class="form-control" id="auditTime">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="auditAuditor">Auditor</label>
                    <input type="text" class="form-control" id="auditAuditor" value="Supervisor">
                </div>
                
                <div class="form-group">
                    <label for="auditNotes">Audit Notes</label>
                    <textarea class="form-control" id="auditNotes" rows="3" placeholder="Enter any notes or observations..."></textarea>
                </div>
                
                <h3 class="section-title">Audit Items</h3>
                <div class="form-group">
                    <button class="btn btn-info btn-sm" id="addAuditItemBtn">
                        <i class="fas fa-plus"></i> Add Audit Item
                    </button>
                </div>
                
                <div id="auditItemsContainer">
                    <!-- Audit items will be added here dynamically -->
                </div>
                
                <div class="form-group">
                    <label>Audit Summary</label>
                    <div id="auditSummary" style="padding: 1rem; background: var(--bg-tertiary); border-radius: var(--radius-md); margin-top: 1rem;">
                        <div class="audit-summary-item">
                            <strong>Total Items:</strong> <span id="auditTotalItems">0</span>
                        </div>
                        <div class="audit-summary-item">
                            <strong>Items Checked:</strong> <span id="auditItemsChecked">0</span>
                        </div>
                        <div class="audit-summary-item">
                            <strong>Discrepancies:</strong> <span id="auditDiscrepancies">0</span>
                        </div>
                        <div class="audit-summary-item">
                            <strong>Accuracy Rate:</strong> <span id="auditAccuracy">100%</span>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 0.75rem;">
                    <button class="btn btn-primary" id="saveAuditBtn">Save Audit</button>
                    <button class="btn btn-danger" id="deleteAuditBtn" style="display: none;">Delete Audit</button>
                    <button class="btn btn-success" id="completeAuditBtn">Mark as Complete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- All Feedback Modal -->
    <div id="allFeedbackModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>All Customer Feedback</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="feedback-stats" style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                    <div class="stat-card" style="padding: 1rem; background: var(--bg-tertiary); flex: 1;">
                        <div class="stat-value" id="totalFeedbackCount">0</div>
                        <div class="stat-label">Total Reviews</div>
                    </div>
                    <div class="stat-card" style="padding: 1rem; background: var(--bg-tertiary); flex: 1;">
                        <div class="stat-value" id="averageRatingAll">0.0</div>
                        <div class="stat-label">Average Rating</div>
                    </div>
                    <div class="stat-card" style="padding: 1rem; background: var(--bg-tertiary); flex: 1;">
                        <div class="stat-value" id="fiveStarCount">0</div>
                        <div class="stat-label">5-Star Reviews</div>
                    </div>
                </div>
                
                <div class="management-tabs">
                    <button class="tab-btn active" data-tab="allFeedback">All Feedback</button>
                    <button class="tab-btn" data-tab="lowRatings">Low Ratings (1-2 Stars)</button>
                    <button class="tab-btn" data-tab="highRatings">High Ratings (4-5 Stars)</button>
                </div>
                
                <div class="tab-content active" id="allFeedback">
                    <div id="allFeedbackList" style="max-height: 400px; overflow-y: auto; padding: 0.5rem;">
                        <!-- All feedback will be loaded here -->
                    </div>
                </div>
                
                <div class="tab-content" id="lowRatings">
                    <div id="lowRatingsList" style="max-height: 400px; overflow-y: auto; padding: 0.5rem;">
                        <!-- Low ratings will be loaded here -->
                    </div>
                </div>
                
                <div class="tab-content" id="highRatings">
                    <div id="highRatingsList" style="max-height: 400px; overflow-y: auto; padding: 0.5rem;">
                        <!-- High ratings will be loaded here -->
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem; display: flex; gap: 0.75rem;">
                    <button class="btn btn-primary" id="exportFeedbackBtn">
                        <i class="fas fa-download"></i> Export Feedback
                    </button>
                    <button class="btn btn-info" id="refreshFeedbackBtn">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Operations Modal -->
    <div id="operationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Operations Management</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="management-tabs">
                    <button class="tab-btn active" data-tab="dailyOps">Daily Operations</button>
                    <button class="tab-btn" data-tab="equipmentOps">Equipment Management</button>
                    <button class="tab-btn" data-tab="reportsOps">Reports</button>
                </div>
                
                <div class="tab-content active" id="dailyOps">
                    <h3 class="section-title"><i class="fas fa-clipboard-check"></i> Complete Daily Checklist</h3>
                    <div id="fullChecklistContainer">
                        <!-- Full checklist will be loaded here -->
                    </div>
                    
                    <div style="display: flex; gap: 0.75rem; margin-top: 1.5rem;">
                        <button class="btn btn-primary" id="markAllCompleteBtn">
                            <i class="fas fa-check-double"></i> Mark All Complete
                        </button>
                        <button class="btn btn-warning" id="resetAllChecklistBtn">
                            <i class="fas fa-redo"></i> Reset All
                        </button>
                        <button class="btn btn-success" id="saveChecklistBtn">
                            <i class="fas fa-save"></i> Save Checklist
                        </button>
                    </div>
                </div>
                
                <div class="tab-content" id="equipmentOps">
                    <h3 class="section-title"><i class="fas fa-cogs"></i> Equipment Status Management</h3>
                    <div id="fullEquipmentContainer">
                        <!-- Full equipment list will be loaded here -->
                    </div>
                    
                    <div style="display: flex; gap: 0.75rem; margin-top: 1.5rem;">
                        <button class="btn btn-primary" id="addEquipmentBtn">
                            <i class="fas fa-plus"></i> Add Equipment
                        </button>
                        <button class="btn btn-success" id="saveEquipmentBtn">
                            <i class="fas fa-save"></i> Save Equipment Status
                        </button>
                    </div>
                </div>
                
                <div class="tab-content" id="reportsOps">
                    <h3 class="section-title"><i class="fas fa-chart-bar"></i> Operations Reports</h3>
                    
                    <div class="stats-grid" style="margin-bottom: 1.5rem;">
                        <div class="stat-card">
                            <div class="stat-content">
                                <div>
                                    <div class="stat-value" id="weeklyCompletion">0%</div>
                                    <div class="stat-label">Weekly Completion</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-content">
                                <div>
                                    <div class="stat-value" id="equipmentUptime">100%</div>
                                    <div class="stat-label">Equipment Uptime</div>
                                </div>
                                <div class="stat-icon">
                                    <i class="fas fa-tools"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" id="generateWeeklyReportBtn" style="width: 100%; margin-bottom: 1rem;">
                        <i class="fas fa-file-pdf"></i> Generate Weekly Report
                    </button>
                    <button class="btn btn-info" id="viewHistoricalDataBtn" style="width: 100%;">
                        <i class="fas fa-history"></i> View Historical Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="management-tabs">
                    <button class="tab-btn active" data-tab="generalSettings">General</button>
                    <button class="tab-btn" data-tab="notificationsSettings">Notifications</button>
                    <button class="tab-btn" data-tab="dataSettings">Data Management</button>
                </div>
                
                <div class="tab-content active" id="generalSettings">
                    <h3 class="section-title">General Settings</h3>
                    
                    <div class="form-group">
                        <label for="coffeeShopName">Coffee Shop Name</label>
                        <input type="text" class="form-control" id="coffeeShopName" value="The Coffee Affair">
                    </div>
                    
                    <div class="form-group">
                        <label for="timezone">Timezone</label>
                        <select class="form-control" id="timezone">
                            <option value="UTC-5">Eastern Time (ET)</option>
                            <option value="UTC-8">Pacific Time (PT)</option>
                            <option value="UTC+0">GMT</option>
                            <option value="UTC+5.5" selected>Indian Standard Time (IST)</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-primary" id="saveGeneralSettings">
                        <i class="fas fa-save"></i> Save Settings
                    </button>
                </div>
                
                <div class="tab-content" id="notificationsSettings">
                    <h3 class="section-title">Notification Settings</h3>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="lowStockAlerts" checked> Low stock alerts
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="taskReminders" checked> Task reminders
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="newFeedbackAlerts" checked> New feedback alerts
                        </label>
                    </div>
                    
                    <button class="btn btn-primary" id="saveNotificationSettings">
                        <i class="fas fa-save"></i> Save Notification Settings
                    </button>
                </div>
                
                <div class="tab-content" id="dataSettings">
                    <h3 class="section-title">Data Management</h3>
                    
                    <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
                        <button class="btn btn-info" id="backupDataBtn">
                            <i class="fas fa-download"></i> Backup Data
                        </button>
                        <button class="btn btn-warning" id="clearDataBtn">
                            <i class="fas fa-trash"></i> Clear All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div class="notification" id="notification"></div>
    
    <script>
        // Data storage for the application
        let staffData = (function() {
            // Load each component from localStorage with fallbacks
            return {
                employees: JSON.parse(localStorage.getItem('supervisorEmployees')) || [
                    { id: 1, name: "John Doe", role: "Head Barista", avatar: "JD" },
                    { id: 2, name: "Sarah Johnson", role: "Barista", avatar: "SJ" },
                    { id: 3, name: "Mike Brown", role: "Cashier", avatar: "MB" },
                    { id: 4, name: "Lisa Chen", role: "Barista", avatar: "LC" },
                    { id: 5, name: "David Wilson", role: "Barista", avatar: "DW" }
                ],
                schedules: JSON.parse(localStorage.getItem('supervisorSchedules')) || [
                    { employeeId: 1, day: "MON", start: "07:00", end: "15:00" },
                    { employeeId: 2, day: "MON", start: "09:00", end: "17:00" },
                    { employeeId: 3, day: "MON", start: "10:00", end: "18:00" },
                    { employeeId: 5, day: "MON", start: "12:00", end: "20:00" },
                    { employeeId: 1, day: "TUE", start: "07:00", end: "15:00" },
                    { employeeId: 2, day: "TUE", start: "09:00", end: "17:00" },
                    { employeeId: 3, day: "TUE", start: "10:00", end: "18:00" },
                    { employeeId: 4, day: "TUE", start: "12:00", end: "20:00" },
                    { employeeId: 1, day: "THU", start: "07:00", end: "15:00" },
                    { employeeId: 2, day: "THU", start: "09:00", end: "17:00" },
                    { employeeId: 3, day: "THU", start: "10:00", end: "18:00" },
                    { employeeId: 4, day: "THU", start: "12:00", end: "20:00" },
                    { employeeId: 1, day: "FRI", start: "07:00", end: "15:00" },
                    { employeeId: 2, day: "FRI", start: "09:00", end: "17:00" },
                    { employeeId: 3, day: "FRI", start: "10:00", end: "18:00" },
                    { employeeId: 4, day: "FRI", start: "12:00", end: "20:00" },
                    { employeeId: 5, day: "FRI", start: "14:00", end: "22:00" },
                    { employeeId: 1, day: "SAT", start: "08:00", end: "16:00" },
                    { employeeId: 2, day: "SAT", start: "10:00", end: "18:00" },
                    { employeeId: 3, day: "SAT", start: "12:00", end: "20:00" },
                    { employeeId: 5, day: "SAT", start: "14:00", end: "22:00" },
                    { employeeId: 1, day: "SUN", start: "08:00", end: "16:00" },
                    { employeeId: 2, day: "SUN", start: "10:00", end: "18:00" },
                    { employeeId: 4, day: "SUN", start: "12:00", end: "20:00" },
                    { employeeId: 5, day: "SUN", start: "14:00", end: "22:00" }
                ],
                timeClock: JSON.parse(localStorage.getItem('supervisorTimeClock')) || [
                    { id: 1, employeeId: 1, shift: "7:00-15:00", clockIn: "6:58", clockOut: "", status: "On Duty" },
                    { id: 2, employeeId: 2, shift: "9:00-17:00", clockIn: "8:55", clockOut: "", status: "On Duty" },
                    { id: 3, employeeId: 3, shift: "10:00-18:00", clockIn: "", clockOut: "", status: "Absent" }
                ],
                tasks: JSON.parse(localStorage.getItem('supervisorTasks')) || [
                    { id: 1, title: "Quality Control Check", assigneeId: 1, dueDate: new Date().toISOString().split('T')[0], dueTime: "14:00", completed: false },
                    { id: 2, title: "Clean Coffee Grinder", assigneeId: 2, dueDate: new Date().toISOString().split('T')[0], dueTime: "16:00", completed: false },
                    { id: 3, title: "Opening Procedures", assigneeId: 1, dueDate: new Date().toISOString().split('T')[0], dueTime: "07:15", completed: true }
                ],
                inventory: JSON.parse(localStorage.getItem('bistroInventory')) || [
                    { 
                        id: 1, 
                        name: 'Arabica Coffee Beans', 
                        category: 'coffee', 
                        stock: 25, 
                        unit: 'kg', 
                        minLevel: 10, 
                        maxLevel: 50,
                        lastUpdated: new Date().toISOString().split('T')[0]
                    },
                    { 
                        id: 2, 
                        name: 'Oat Milk', 
                        category: 'dairy', 
                        stock: 8, 
                        unit: 'l', 
                        minLevel: 5, 
                        maxLevel: 30,
                        lastUpdated: new Date().toISOString().split('T')[0]
                    },
                    { 
                        id: 3, 
                        name: 'Croissants', 
                        category: 'food', 
                        stock: 24, 
                        unit: 'units', 
                        minLevel: 12, 
                        maxLevel: 48,
                        lastUpdated: new Date().toISOString().split('T')[0]
                    },
                    { 
                        id: 4, 
                        name: 'Paper Cups', 
                        category: 'supplies', 
                        stock: 200, 
                        unit: 'units', 
                        minLevel: 100, 
                        maxLevel: 500,
                        lastUpdated: new Date().toISOString().split('T')[0]
                    }
                ],
                inventoryUpdates: JSON.parse(localStorage.getItem('supervisorInventoryUpdates')) || [
                    { id: 1, item: "Coffee Beans", updatedBy: "John Doe", date: new Date().toISOString().split('T')[0], time: "10:30", change: "-5kg", newLevel: "Low" },
                    { id: 2, item: "Oat Milk", updatedBy: "Sarah Johnson", date: new Date().toISOString().split('T')[0], time: "9:15", change: "-10 units", newLevel: "Low" },
                    { id: 3, item: "Paper Cups", updatedBy: "Mike Brown", date: new Date(Date.now() - 86400000).toISOString().split('T')[0], time: "4:20", change: "-50 units", newLevel: "Medium" }
                ],
                inventoryAudits: JSON.parse(localStorage.getItem('bistroInventoryAudits')) || [
                    { 
                        id: 1, 
                        date: new Date(Date.now() - 86400000).toISOString().split('T')[0], 
                        time: "10:00", 
                        auditor: "Supervisor", 
                        items: [
                            { itemId: 1, itemName: "Arabica Coffee Beans", expected: 30, actual: 25, discrepancy: -5, notes: "Weekly usage" }
                        ],
                        status: "Completed",
                        totalItems: 4,
                        itemsChecked: 1,
                        discrepancies: 1,
                        accuracyRate: "75%"
                    }
                ],
                operations: JSON.parse(localStorage.getItem('coffeeShopOperationsData')) || {
                    checklist: [
                        { id: 1, name: "Opening procedures completed", completed: false },
                        { id: 2, name: "Quality control check", completed: false },
                        { id: 3, name: "Equipment maintenance review", completed: false },
                        { id: 4, name: "Inventory count", completed: false },
                        { id: 5, name: "Closing procedures", completed: false }
                    ],
                    equipment: [
                        { id: 1, name: "Espresso Machine", status: "Operational" },
                        { id: 2, name: "Coffee Grinder", status: "Needs cleaning" },
                        { id: 3, name: "Refrigerator", status: "Operational" },
                        { id: 4, name: "POS System", status: "Operational" }
                    ]
                }
            };
        })();

        // Current editing state
        let currentEditing = {
            employee: null,
            day: null,
            task: null,
            inventory: null,
            timeClock: null,
            order: null,
            inventoryUpdate: null,
            inventoryAudit: null
        };

        // Category-based unit options
        const unitOptions = {
            coffee: [
                { value: "kg", label: "Kilograms (kg)" },
                { value: "g", label: "Grams (g)" },
                { value: "l", label: "Liters (l)" },
                { value: "ml", label: "Milliliters (ml)" },
                { value: "packs", label: "Packs" },
                { value: "bags", label: "Bags" },
                { value: "bottles", label: "Bottles" }
            ],
            dairy: [
                { value: "l", label: "Liters (l)" },
                { value: "ml", label: "Milliliters (ml)" },
                { value: "packs", label: "Packs" },
                { value: "cartons", label: "Cartons" }
            ],
            food: [
                { value: "units", label: "Units" },
                { value: "kg", label: "Kilograms (kg)" },
                { value: "g", label: "Grams (g)" },
                { value: "boxes", label: "Boxes" },
                { value: "trays", label: "Trays" }
            ],
            supplies: [
                { value: "units", label: "Units" },
                { value: "packs", label: "Packs" },
                { value: "boxes", label: "Boxes" },
                { value: "cases", label: "Cases" },
                { value: "rolls", label: "Rolls" }
            ]
        };

        // In the DOMContentLoaded event listener or initialization section:
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Supervisor Dashboard initialized');
            
            // Initialize all components
            setupEventListeners();
            initializeDashboard();
            initializeStaffManagement();
            
            // Set up real-time updates
            startRealTimeUpdates();
            
            // Initial sync with admin system
            const bistroEmployees = JSON.parse(localStorage.getItem('bistroEmployees'));
            if (bistroEmployees) {
                syncEmployeesFromAdmin(bistroEmployees);
            }
            
            // Update date display
            updateDate();
            
            console.log('Time clock synchronization ready');
        });

        // Update date display
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
        }

        // Navigation functions
        function showDashboard() {
            document.getElementById('dashboardContent').style.display = 'block';
            document.getElementById('staffManagementContent').style.display = 'none';
            document.getElementById('pageTitle').textContent = 'Supervisor Dashboard';
            updateNavActive('dashboard');
        }

        function showStaffManagement() {
            document.getElementById('dashboardContent').style.display = 'none';
            document.getElementById('staffManagementContent').style.display = 'block';
            document.getElementById('pageTitle').textContent = 'Staff Management';
            updateNavActive('staff');
        }

        function showOperations() {
            document.getElementById('operationsModal').style.display = 'block';
            loadFullChecklist();
            loadFullEquipment();
            updateOperationsStats();
            updateNavActive('operations');
        }

        function showInventory() {
            document.getElementById('staffManagementModal').style.display = 'block';
            document.querySelector('[data-tab="inventory"]').click();
            updateNavActive('inventory');
        }

        function showCustomerService() {
            const customerServiceCard = document.querySelector('.dashboard-card:nth-child(3)');
            if (customerServiceCard) {
                customerServiceCard.scrollIntoView({ behavior: 'smooth' });
            }
            updateNavActive('customer');
        }

        function showSettings() {
            document.getElementById('settingsModal').style.display = 'block';
            updateNavActive('settings');
        }

        function updateNavActive(activeItem) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const navMap = {
                'dashboard': 0,
                'staff': 1,
                'operations': 2,
                'inventory': 3,
                'customer': 4,
                'settings': 5
            };
            
            if (navMap[activeItem] !== undefined) {
                document.querySelectorAll('.nav-item')[navMap[activeItem]].classList.add('active');
            }
        }

        // Set up all event listeners
        function setupEventListeners() {
            // Staff Management Modal Functionality
            const manageStaffBtn = document.getElementById('manageStaffBtn');
            const staffManagementModal = document.getElementById('staffManagementModal');
            const closeBtns = document.querySelectorAll('.close-btn');
            const tabBtns = document.querySelectorAll('.tab-btn');
            const tabContents = document.querySelectorAll('.tab-content');

            // Open modal when Manage Staff button is clicked
            if (manageStaffBtn) {
                manageStaffBtn.addEventListener('click', function() {
                    if (staffManagementModal) {
                        staffManagementModal.style.display = 'block';
                    }
                });
            }
            
            // Close modals when close button is clicked
            closeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                });
            });
            
            // Close modals when clicking outside the modal content
            window.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    event.target.style.display = 'none';
                }
            });
            
            // Tab functionality
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and contents
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to current tab and content
                    this.classList.add('active');
                    const tabContent = document.getElementById(tabId);
                    if (tabContent) {
                        tabContent.classList.add('active');
                    }

                    // If the inventory tab is clicked, update the stats and alerts
                    if (tabId === 'inventory') {
                        updateInventoryStats();
                        updateInventoryAlerts();
                        renderInventoryAudits();
                    }
                    
                    // If the tasks tab is clicked, render the tasks
                    if (tabId === 'tasks') {
                        renderTasks();
                    }
                });
            });
            
            // Dashboard button functionality
            const updateOperationsBtn = document.getElementById('updateOperationsBtn');
            if (updateOperationsBtn) {
                updateOperationsBtn.addEventListener('click', function() {
                    showNotification('Operations updated successfully!', 'success');
                });
            }
            
            const viewFeedbackBtn = document.getElementById('viewFeedbackBtn');
            if (viewFeedbackBtn) {
                viewFeedbackBtn.addEventListener('click', function() {
                    renderAllFeedback();
                    document.getElementById('allFeedbackModal').style.display = 'block';
                });
            }
            
            // Operations Management buttons
            const resetChecklistBtn = document.getElementById('resetChecklistBtn');
            if (resetChecklistBtn) {
                resetChecklistBtn.addEventListener('click', resetDailyChecklist);
            }
            
            const resetEquipmentBtn = document.getElementById('resetEquipmentBtn');
            if (resetEquipmentBtn) {
                resetEquipmentBtn.addEventListener('click', resetEquipmentStatus);
            }
            
            // Sync employees button
            const syncEmployeesBtn = document.getElementById('syncEmployeesBtn');
            if (syncEmployeesBtn) {
                syncEmployeesBtn.addEventListener('click', function() {
                    syncToAdminSystem();
                });
            }

            // Enhanced event delegation for dynamically created elements
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('edit-time-btn')) {
                    const entryId = parseInt(e.target.dataset.entryId);
                    editTimeClock(entryId);
                }
                
                if (e.target.classList.contains('delete-time-btn')) {
                    const entryId = parseInt(e.target.dataset.entryId);
                    deleteTimeClockEntry(entryId);
                }
                
                if (e.target.classList.contains('edit-inventory-update-btn')) {
                    const updateId = parseInt(e.target.dataset.updateId);
                    editInventoryUpdate(updateId);
                }
                
                if (e.target.classList.contains('delete-inventory-update-btn')) {
                    const updateId = parseInt(e.target.dataset.updateId);
                    if (confirm('Are you sure you want to delete this inventory update?')) {
                        staffData.inventoryUpdates = staffData.inventoryUpdates.filter(u => u.id !== updateId);
                        renderInventoryUpdates();
                        showNotification('Inventory update deleted successfully!', 'success');
                    }
                }
            });
            
            // Scheduling tab buttons
            const createScheduleBtn = document.getElementById('createScheduleBtn');
            if (createScheduleBtn) {
                createScheduleBtn.addEventListener('click', createNewSchedule);
            }
            
            const copyScheduleBtn = document.getElementById('copyScheduleBtn');
            if (copyScheduleBtn) {
                copyScheduleBtn.addEventListener('click', function() {
                    showNotification('Previous week schedule copied!', 'success');
                });
            }
            
            // Sync with Admin button in scheduling tab
            const syncWithAdminBtn = document.getElementById('syncWithAdminBtn');
            if (syncWithAdminBtn) {
                syncWithAdminBtn.addEventListener('click', function() {
                    syncToAdminSystem();
                });
            }
            
            // Time Clock tab buttons
            const createTimeClockBtn = document.getElementById('createTimeClockBtn');
            if (createTimeClockBtn) {
                createTimeClockBtn.addEventListener('click', createTimeClockEntry);
            }
            
            const saveTimeClockBtn = document.getElementById('saveTimeClockBtn');
            if (saveTimeClockBtn) {
                saveTimeClockBtn.addEventListener('click', function() {
                    if (document.getElementById('timeClockEmployeeSelectGroup').style.display === 'block') {
                        saveNewTimeClockEntry();
                    } else {
                        saveTimeClock();
                    }
                });
            }
            
            const deleteTimeClockBtn = document.getElementById('deleteTimeClockBtn');
            if (deleteTimeClockBtn) {
                deleteTimeClockBtn.addEventListener('click', function() {
                    const entryId = currentEditing.timeClock;
                    if (entryId) {
                        deleteTimeClockEntry(entryId);
                        document.getElementById('editTimeClockModal').style.display = 'none';
                    }
                });
            }
            
            // Task Management tab buttons
            const createTaskBtn = document.getElementById('createTaskBtn');
            if (createTaskBtn) {
                createTaskBtn.addEventListener('click', createNewTask);
            }
            
            const generateChecklistBtn = document.getElementById('generateChecklistBtn');
            if (generateChecklistBtn) {
                generateChecklistBtn.addEventListener('click', function() {
                    showNotification('Daily checklist generated!', 'success');
                });
            }
            
            // Sync Tasks with Admin button
            const syncTasksWithAdminBtn = document.getElementById('syncTasksWithAdminBtn');
            if (syncTasksWithAdminBtn) {
                syncTasksWithAdminBtn.addEventListener('click', function() {
                    syncToAdminSystem();
                });
            }
            
            // Inventory Coordination tab buttons
            const createInventoryUpdateBtn = document.getElementById('createInventoryUpdateBtn');
            if (createInventoryUpdateBtn) {
                createInventoryUpdateBtn.addEventListener('click', createInventoryUpdate);
            }
            
            // Edit modal buttons
            const saveScheduleBtn = document.getElementById('saveScheduleBtn');
            if (saveScheduleBtn) {
                saveScheduleBtn.addEventListener('click', saveSchedule);
            }
            
            const saveTaskBtn = document.getElementById('saveTaskBtn');
            if (saveTaskBtn) {
                saveTaskBtn.addEventListener('click', saveTask);
            }
            
            const saveInventoryBtn = document.getElementById('saveInventoryBtn');
            if (saveInventoryBtn) {
                saveInventoryBtn.addEventListener('click', saveInventory);
            }
            
            const deleteScheduleBtn = document.getElementById('deleteScheduleBtn');
            if (deleteScheduleBtn) {
                deleteScheduleBtn.addEventListener('click', deleteSchedule);
            }
            
            const deleteTaskBtn = document.getElementById('deleteTaskBtn');
            if (deleteTaskBtn) {
                deleteTaskBtn.addEventListener('click', deleteTask);
            }
            
            const deleteInventoryBtn = document.getElementById('deleteInventoryBtn');
            if (deleteInventoryBtn) {
                deleteInventoryBtn.addEventListener('click', deleteInventory);
            }

            // Add event listeners for category change and unit updates
            const inventoryCategory = document.getElementById('inventoryCategory');
            if (inventoryCategory) {
                inventoryCategory.addEventListener('change', function() {
                    updateUnitOptions(this.value);
                });
            }
            
            // Update unit display when unit selection changes
            const inventoryUnit = document.getElementById('inventoryUnit');
            if (inventoryUnit) {
                inventoryUnit.addEventListener('change', function() {
                    const selectedUnit = this.value;
                    document.getElementById('unitDisplay').textContent = selectedUnit;
                    document.getElementById('thresholdUnitDisplay').textContent = selectedUnit;
                    document.getElementById('maxStockUnitDisplay').textContent = selectedUnit;
                    
                    // Update stock level status display when unit changes
                    updateStockLevelStatusDisplay();
                });
            }

            // Add event listeners for quantity and maximum stock changes
            const inventoryQuantity = document.getElementById('inventoryQuantity');
            if (inventoryQuantity) {
                inventoryQuantity.addEventListener('input', function() {
                    updateStockLevelStatusDisplay();
                });
            }

            const inventoryMaximumStock = document.getElementById('inventoryMaximumStock');
            if (inventoryMaximumStock) {
                inventoryMaximumStock.addEventListener('input', function() {
                    updateStockLevelStatusDisplay();
                });
            }

            // Add inventory button handlers
            setupInventoryButtonHandlers();

            // Add audit button handlers
            setupAuditButtonHandlers();
            
            // Task checklist functionality
            setupTaskChecklist();
            
            // Equipment status functionality
            setupEquipmentStatus();
            
            // Header buttons
            const notificationBell = document.getElementById('notificationBell');
            if (notificationBell) {
                notificationBell.addEventListener('click', function() {
                    this.classList.add('pulse');
                    setTimeout(() => this.classList.remove('pulse'), 1000);
                    showNotification('You have 3 unread notifications', 'info');
                });
            }
            
            const syncDataBtn = document.getElementById('syncDataBtn');
            if (syncDataBtn) {
                syncDataBtn.addEventListener('click', function() {
                    syncToAdminSystem();
                });
            }
            
            const quickReportBtn = document.getElementById('quickReportBtn');
            if (quickReportBtn) {
                quickReportBtn.addEventListener('click', function() {
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
                    setTimeout(() => {
                        this.innerHTML = '<i class="fas fa-check"></i> Report Ready';
                        setTimeout(() => {
                            this.innerHTML = '<i class="fas fa-file-export"></i> Generate Report';
                        }, 2000);
                    }, 1500);
                    showNotification('Daily report generated successfully!', 'success');
                });
            }
            
            // Operations modal buttons
            const markAllCompleteBtn = document.getElementById('markAllCompleteBtn');
            if (markAllCompleteBtn) {
                markAllCompleteBtn.addEventListener('click', function() {
                    staffData.operations.checklist.forEach(task => {
                        task.completed = true;
                    });
                    loadFullChecklist();
                    saveOperationsData();
                    showNotification('All tasks marked as complete', 'success');
                });
            }
            
            const resetAllChecklistBtn = document.getElementById('resetAllChecklistBtn');
            if (resetAllChecklistBtn) {
                resetAllChecklistBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to reset all checklist items?')) {
                        staffData.operations.checklist.forEach(task => {
                            task.completed = false;
                        });
                        loadFullChecklist();
                        saveOperationsData();
                        showNotification('Checklist reset', 'info');
                    }
                });
            }
            
            const addEquipmentBtn = document.getElementById('addEquipmentBtn');
            if (addEquipmentBtn) {
                addEquipmentBtn.addEventListener('click', function() {
                    const newId = staffData.operations.equipment.length > 0 
                        ? Math.max(...staffData.operations.equipment.map(e => e.id)) + 1 
                        : 1;
                    
                    const newEquipment = {
                        id: newId,
                        name: `New Equipment ${newId}`,
                        status: 'Operational'
                    };
                    
                    staffData.operations.equipment.push(newEquipment);
                    loadFullEquipment();
                    saveOperationsData();
                    showNotification('New equipment added', 'success');
                });
            }
            
            // Settings modal buttons
            const saveGeneralSettingsBtn = document.getElementById('saveGeneralSettings');
            if (saveGeneralSettingsBtn) {
                saveGeneralSettingsBtn.addEventListener('click', function() {
                    showNotification('Settings saved successfully', 'success');
                });
            }
            
            const backupDataBtn = document.getElementById('backupDataBtn');
            if (backupDataBtn) {
                backupDataBtn.addEventListener('click', function() {
                    const backupData = {
                        timestamp: new Date().toISOString(),
                        staffData: staffData,
                        operations: JSON.parse(localStorage.getItem('coffeeShopOperationsData')),
                        feedback: JSON.parse(localStorage.getItem('bistroRatings'))
                    };
                    
                    const dataStr = JSON.stringify(backupData, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `coffee-shop-backup-${new Date().toISOString().split('T')[0]}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                    
                    showNotification('Data backup created', 'success');
                });
            }
            
            const clearDataBtn = document.getElementById('clearDataBtn');
            if (clearDataBtn) {
                clearDataBtn.addEventListener('click', function() {
                    if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                        localStorage.clear();
                        location.reload();
                    }
                });
            }
            
            // Feedback modal buttons
            const exportFeedbackBtn = document.getElementById('exportFeedbackBtn');
            if (exportFeedbackBtn) {
                exportFeedbackBtn.addEventListener('click', exportFeedback);
            }
            
            const refreshFeedbackBtn = document.getElementById('refreshFeedbackBtn');
            if (refreshFeedbackBtn) {
                refreshFeedbackBtn.addEventListener('click', function() {
                    renderAllFeedback();
                    showNotification('Feedback refreshed', 'success');
                });
            }
            
            // Animate stat counters on load
            setTimeout(() => {
                animateStatCounters();
            }, 500);
        }

        // Animate stat counters
        function animateStatCounters() {
            const counters = document.querySelectorAll('.stat-value');
            counters.forEach(counter => {
                const text = counter.textContent;
                if (text.includes('₹') || text.includes('%') || text.includes('.')) {
                    // Already formatted, skip animation
                    return;
                }
                
                const finalValue = parseFloat(text);
                let start = 0;
                const duration = 1500;
                const increment = finalValue / (duration / 16);
                
                const timer = setInterval(() => {
                    start += increment;
                    if (start >= finalValue) {
                        counter.textContent = finalValue;
                        clearInterval(timer);
                    } else {
                        counter.textContent = Math.round(start);
                    }
                }, 16);
            });
        }

        // Setup task checklist
        function setupTaskChecklist() {
            document.querySelectorAll('#dailyChecklist .task-item').forEach(item => {
                const checkbox = item.querySelector('.task-checkbox');
                checkbox.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const taskId = parseInt(item.dataset.taskId);
                    const task = staffData.operations.checklist.find(t => t.id === taskId);
                    
                    if (task) {
                        task.completed = !task.completed;
                        item.classList.toggle('completed');
                        
                        const statusElement = item.querySelector('.task-status');
                        if (task.completed) {
                            statusElement.textContent = 'Completed';
                            statusElement.style.background = 'var(--success)';
                            checkbox.innerHTML = '<i class="fas fa-check"></i>';
                            checkbox.style.background = 'var(--success)';
                            checkbox.style.borderColor = 'var(--success)';
                            checkbox.style.color = 'white';
                        } else {
                            statusElement.textContent = 'Pending';
                            statusElement.style.background = 'var(--warning)';
                            checkbox.innerHTML = '';
                            checkbox.style.background = 'transparent';
                            checkbox.style.borderColor = 'var(--border-medium)';
                        }
                        
                        updateCompletionStats();
                        saveOperationsData();
                    }
                });
            });
        }

        // Setup equipment status
        function setupEquipmentStatus() {
            document.querySelectorAll('#equipmentStatus .equipment-item').forEach(item => {
                item.addEventListener('click', function() {
                    const equipmentId = parseInt(this.dataset.equipmentId);
                    const equipment = staffData.operations.equipment.find(e => e.id === equipmentId);
                    
                    if (equipment) {
                        const statusElement = this.querySelector('.equipment-status');
                        const statusText = statusElement.textContent;
                        
                        if (statusText === 'Operational') {
                            equipment.status = 'Needs cleaning';
                            statusElement.textContent = 'Needs cleaning';
                            statusElement.className = 'equipment-status needs-cleaning';
                        } else if (statusText === 'Needs cleaning') {
                            equipment.status = 'Needs maintenance';
                            statusElement.textContent = 'Needs maintenance';
                            statusElement.className = 'equipment-status needs-maintenance';
                        } else {
                            equipment.status = 'Operational';
                            statusElement.textContent = 'Operational';
                            statusElement.className = 'equipment-status operational';
                        }
                        
                        saveOperationsData();
                    }
                });
            });
        }

        // Setup audit button handlers
        function setupAuditButtonHandlers() {
            // Run new audit
            const runAuditBtn = document.getElementById('runAuditBtn');
            if (runAuditBtn) {
                runAuditBtn.addEventListener('click', function() {
                    currentEditing.inventoryAudit = null;
                    
                    // Clear form
                    document.getElementById('auditDate').value = new Date().toISOString().split('T')[0];
                    document.getElementById('auditTime').value = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    document.getElementById('auditAuditor').value = 'Supervisor';
                    document.getElementById('auditNotes').value = '';
                    document.getElementById('auditItemsContainer').innerHTML = '';
                    
                    // Add one empty audit item row
                    addAuditItemRow();
                    
                    // Update summary
                    updateAuditSummary();
                    
                    // Open modal
                    document.getElementById('inventoryAuditModal').style.display = 'block';
                });
            }

            // Export audit report
            const exportAuditBtn = document.getElementById('exportAuditBtn');
            if (exportAuditBtn) {
                exportAuditBtn.addEventListener('click', function() {
                    if (staffData.inventoryAudits.length === 0) {
                        showNotification('No audit data to export', 'warning');
                        return;
                    }
                    
                    // Create CSV content
                    let csv = 'Audit ID,Date,Time,Auditor,Items Audited,Discrepancies,Status,Accuracy Rate\n';
                    
                    staffData.inventoryAudits.forEach(audit => {
                        csv += `#${audit.id.toString().padStart(3, '0')},`;
                        csv += `${audit.date},`;
                        csv += `${audit.time},`;
                        csv += `${audit.auditor},`;
                        csv += `${audit.items ? audit.items.length : 0},`;
                        csv += `${audit.discrepancies || 0},`;
                        csv += `${audit.status},`;
                        csv += `${audit.accuracyRate || '100%'}\n`;
                    });
                    
                    // Create download link
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `inventory-audits-${new Date().toISOString().split('T')[0]}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    showNotification('Audit report exported successfully!', 'success');
                });
            }

            // Clear old audits
            const clearOldAuditsBtn = document.getElementById('clearOldAuditsBtn');
            if (clearOldAuditsBtn) {
                clearOldAuditsBtn.addEventListener('click', function() {
                    if (staffData.inventoryAudits.length === 0) {
                        showNotification('No audits to clear', 'warning');
                        return;
                    }
                    
                    if (confirm('Are you sure you want to clear audit records older than 30 days?')) {
                        const thirtyDaysAgo = new Date();
                        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                        
                        const oldCount = staffData.inventoryAudits.length;
                        staffData.inventoryAudits = staffData.inventoryAudits.filter(audit => {
                            const auditDate = new Date(audit.date);
                            return auditDate >= thirtyDaysAgo;
                        });
                        
                        const removedCount = oldCount - staffData.inventoryAudits.length;
                        
                        if (removedCount > 0) {
                            saveAuditsToLocalStorage();
                            renderInventoryAudits();
                            showNotification(`Cleared ${removedCount} old audit records`, 'success');
                        } else {
                            showNotification('No old audit records found', 'info');
                        }
                    }
                });
            }
        }

        // Initialize dashboard functionality
        function initializeDashboard() {
            // Update dashboard with current employee data
            updateDashboardStaffList();
            updateStaffDashboard();
            
            // Initialize operations management
            renderDailyChecklist();
            renderEquipmentStatus();
            updateCompletionStats();
            
            // Initialize time clock dashboard
            renderTimeClockDashboard();
            renderCustomerFeedback();
        }

        // Update the updateDashboardStaffList function to properly initialize avatars:
        function updateDashboardStaffList() {
            const staffItems = document.querySelectorAll('.staff-item');
            staffItems.forEach(item => {
                const employeeId = parseInt(item.dataset.employeeId);
                const employee = staffData.employees.find(emp => emp.id === employeeId);
                if (employee) {
                    item.querySelector('.staff-name').textContent = employee.name;
                    // Ensure avatar is properly initialized
                    const avatarElement = item.querySelector('.staff-avatar');
                    if (avatarElement) {
                        avatarElement.textContent = employee.avatar || getInitials(employee.name);
                    }
                }
            });
        }

        function saveOperationsData() {
            const operationsData = {
                checklist: staffData.operations.checklist,
                equipment: staffData.operations.equipment,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('coffeeShopOperationsData', JSON.stringify(operationsData));
        }

        // Initialize staff management functionality
        function initializeStaffManagement() {
            populateEmployeeSelects();
            
            // Use dynamic calendar rendering
            renderCalendar();
            
            renderTimeClock();
            renderTasks();
            
            renderInventory();  
            renderInventoryUpdates();
            
            // Initialize the stats and alerts
            updateInventoryStats();
            updateInventoryAlerts();
            
            // Initialize audits
            renderInventoryAudits();
        }

        // Function to render the calendar dynamically based on current employees
        function renderCalendar() {
            const calendarContainer = document.getElementById('scheduleCalendar');
            if (!calendarContainer) return;
            
            // Clear existing calendar
            calendarContainer.innerHTML = '';
            
            // Get current employees
            const employees = staffData.employees;
            const days = ['MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT', 'SUN'];
            
            // Set grid template columns dynamically
            calendarContainer.style.gridTemplateColumns = `120px repeat(${employees.length}, 1fr)`;
            
            // Create header row
            const dayHeader = document.createElement('div');
            dayHeader.className = 'calendar-day header';
            dayHeader.textContent = 'Day';
            calendarContainer.appendChild(dayHeader);
            
            // Create employee headers
            employees.forEach(employee => {
                const employeeHeader = document.createElement('div');
                employeeHeader.className = 'calendar-day header';
                employeeHeader.innerHTML = `
                    <div class="employee-name" data-employee-id="${employee.id}">${employee.name}</div>
                    <div class="employee-role" data-employee-id="${employee.id}">${employee.role}</div>
                `;
                calendarContainer.appendChild(employeeHeader);
                
                // Add click events for editing names and roles
                const nameElement = employeeHeader.querySelector('.employee-name');
                const roleElement = employeeHeader.querySelector('.employee-role');
                
                nameElement.addEventListener('click', () => editStaffName(employee.id));
                roleElement.addEventListener('click', () => editStaffRole(employee.id));
            });
            
            // Create day rows
            days.forEach(day => {
                // Day label
                const dayLabel = document.createElement('div');
                dayLabel.className = 'calendar-day' + (day === 'WED' ? ' closed' : '');
                dayLabel.textContent = day;
                calendarContainer.appendChild(dayLabel);
                
                // Employee cells for this day
                employees.forEach(employee => {
                    const dayCell = document.createElement('div');
                    dayCell.className = 'calendar-day' + (day === 'WED' ? ' closed' : '');
                    
                    // Find schedule for this employee and day
                    const schedule = staffData.schedules.find(s => 
                        s.employeeId === employee.id && s.day === day
                    );
                    
                    if (schedule && day !== 'WED') {
                        const scheduleElement = document.createElement('div');
                        scheduleElement.className = 'employee-schedule';
                        scheduleElement.setAttribute('data-day', day);
                        scheduleElement.setAttribute('data-employee-id', employee.id);
                        scheduleElement.textContent = `${schedule.start}-${schedule.end}`;
                        
                        scheduleElement.addEventListener('click', () => {
                            editSchedule(employee.id, day);
                        });
                        
                        dayCell.appendChild(scheduleElement);
                    } else if (day === 'WED') {
                        dayCell.textContent = 'Closed';
                    }
                    
                    calendarContainer.appendChild(dayCell);
                });
            });
            updateStaffDashboard();
            renderTodaySchedule();
        }

        // Load full checklist
        function loadFullChecklist() {
            const container = document.getElementById('fullChecklistContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            staffData.operations.checklist.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = `task-item ${task.completed ? 'completed' : ''}`;
                taskItem.dataset.taskId = task.id;
                
                taskItem.innerHTML = `
                    <div class="task-checkbox">${task.completed ? '<i class="fas fa-check"></i>' : ''}</div>
                    <div class="task-content">
                        <div class="task-title">${task.name || task.text || `Task ${task.id}`}</div>
                        <span class="task-status">${task.completed ? 'Completed' : 'Pending'}</span>
                    </div>
                `;
                
                // Add click event
                taskItem.addEventListener('click', function() {
                    task.completed = !task.completed;
                    this.classList.toggle('completed');
                    const checkbox = this.querySelector('.task-checkbox');
                    const status = this.querySelector('.task-status');
                    
                    if (task.completed) {
                        checkbox.innerHTML = '<i class="fas fa-check"></i>';
                        checkbox.style.background = 'var(--success)';
                        checkbox.style.borderColor = 'var(--success)';
                        status.textContent = 'Completed';
                        status.style.background = 'var(--success)';
                    } else {
                        checkbox.innerHTML = '';
                        checkbox.style.background = 'transparent';
                        checkbox.style.borderColor = 'var(--border-medium)';
                        status.textContent = 'Pending';
                        status.style.background = 'var(--warning)';
                    }
                    
                    saveOperationsData();
                });
                
                container.appendChild(taskItem);
            });
        }

        // Load full equipment list
        function loadFullEquipment() {
            const container = document.getElementById('fullEquipmentContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            staffData.operations.equipment.forEach(equipment => {
                const equipmentItem = document.createElement('div');
                equipmentItem.className = 'equipment-item';
                equipmentItem.dataset.equipmentId = equipment.id;
                
                equipmentItem.innerHTML = `
                    <span>${equipment.name}</span>
                    <span class="equipment-status ${equipment.status === 'Operational' ? 'operational' : 
                                                equipment.status === 'Needs Attention' ? 'needs-cleaning' : 
                                                'needs-maintenance'}">${equipment.status}</span>
                `;
                
                // Add click event to cycle through statuses
                equipmentItem.addEventListener('click', function() {
                    const statusElement = this.querySelector('.equipment-status');
                    const currentStatus = statusElement.textContent;
                    
                    if (currentStatus === 'Operational') {
                        equipment.status = 'Needs cleaning';
                        statusElement.textContent = 'Needs cleaning';
                        statusElement.className = 'equipment-status needs-cleaning';
                    } else if (currentStatus === 'Needs cleaning') {
                        equipment.status = 'Needs maintenance';
                        statusElement.textContent = 'Needs maintenance';
                        statusElement.className = 'equipment-status needs-maintenance';
                    } else {
                        equipment.status = 'Operational';
                        statusElement.textContent = 'Operational';
                        statusElement.className = 'equipment-status operational';
                    }
                    
                    saveOperationsData();
                });
                
                container.appendChild(equipmentItem);
            });
        }

        // Update operations stats
        function updateOperationsStats() {
            // Calculate weekly completion
            const completedTasks = staffData.operations.checklist.filter(t => t.completed).length;
            const totalTasks = staffData.operations.checklist.length;
            const weeklyCompletion = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            document.getElementById('weeklyCompletion').textContent = `${weeklyCompletion}%`;
            
            // Calculate equipment uptime
            const operationalEquipment = staffData.operations.equipment.filter(e => e.status === 'Operational').length;
            const totalEquipment = staffData.operations.equipment.length;
            const equipmentUptime = totalEquipment > 0 ? Math.round((operationalEquipment / totalEquipment) * 100) : 100;
            
            document.getElementById('equipmentUptime').textContent = `${equipmentUptime}%`;
        }

        // Add this function to render all feedback
        function renderAllFeedback() {
            const ratings = JSON.parse(localStorage.getItem('bistroRatings')) || [];
            
            // Update stats
            document.getElementById('totalFeedbackCount').textContent = ratings.length;
            
            const avgRating = ratings.length > 0 
                ? (ratings.reduce((sum, r) => sum + (r.rating || 0), 0) / ratings.length).toFixed(1)
                : '0.0';
            document.getElementById('averageRatingAll').textContent = avgRating;
            
            const fiveStarCount = ratings.filter(r => r.rating === 5).length;
            document.getElementById('fiveStarCount').textContent = fiveStarCount;
            
            // Render all feedback
            const allFeedbackList = document.getElementById('allFeedbackList');
            const lowRatingsList = document.getElementById('lowRatingsList');
            const highRatingsList = document.getElementById('highRatingsList');
            
            // Clear lists
            if (allFeedbackList) allFeedbackList.innerHTML = '';
            if (lowRatingsList) lowRatingsList.innerHTML = '';
            if (highRatingsList) highRatingsList.innerHTML = '';
            
            if (ratings.length === 0) {
                const emptyMessage = '<div class="feedback-item"><div class="feedback-comment">No feedback available</div></div>';
                if (allFeedbackList) allFeedbackList.innerHTML = emptyMessage;
                if (lowRatingsList) lowRatingsList.innerHTML = emptyMessage;
                if (highRatingsList) highRatingsList.innerHTML = emptyMessage;
                return;
            }
            
            // Sort by date (newest first)
            const sortedRatings = [...ratings].sort((a, b) => {
                const dateA = a.date ? new Date(a.date) : new Date(0);
                const dateB = b.date ? new Date(b.date) : new Date(0);
                return dateB - dateA;
            });
            
            // Populate lists
            sortedRatings.forEach(r => {
                const feedbackItem = createFeedbackItem(r);
                
                // Add to all feedback
                if (allFeedbackList) allFeedbackList.appendChild(feedbackItem.cloneNode(true));
                
                // Add to appropriate category
                if (r.rating <= 2) {
                    if (lowRatingsList) lowRatingsList.appendChild(feedbackItem.cloneNode(true));
                } else if (r.rating >= 4) {
                    if (highRatingsList) highRatingsList.appendChild(feedbackItem.cloneNode(true));
                }
            });
        }

        function createFeedbackItem(rating) {
            const item = document.createElement('div');
            item.className = 'feedback-item';
            
            const starsHtml = Array.from({ length: 5 }, (_, i) => 
                i < (rating.rating || 0) ? '<i class="fas fa-star"></i>' : '<i class="far fa-star"></i>'
            ).join('');
            
            const comment = rating.feedback && rating.feedback.length > 0 
                ? rating.feedback 
                : 'No comment provided';
            
            const dateStr = rating.date 
                ? new Date(rating.date).toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })
                : 'Date not available';
            
            item.innerHTML = `
                <div class="feedback-rating" style="color: ${rating.rating <= 2 ? 'var(--danger)' : rating.rating >= 4 ? 'var(--success)' : 'var(--warning)'}">
                    ${starsHtml} <span style="font-weight: 600; margin-left: 0.5rem;">${rating.rating || 0}/5</span>
                </div>
                <div class="feedback-comment">${comment}</div>
                <div class="feedback-date">${dateStr}</div>
            `;
            
            return item;
        }

        // Export feedback
        function exportFeedback() {
            const ratings = JSON.parse(localStorage.getItem('bistroRatings')) || [];
            
            if (ratings.length === 0) {
                showNotification('No feedback data to export', 'warning');
                return;
            }
            
            // Create CSV content
            let csv = 'Date,Rating,Feedback\n';
            
            ratings.forEach(r => {
                const date = r.date ? new Date(r.date).toLocaleDateString() : '';
                const rating = r.rating || 0;
                const feedback = (r.feedback || '').replace(/"/g, '""'); // Escape quotes
                csv += `"${date}",${rating},"${feedback}"\n`;
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `customer-feedback-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showNotification('Feedback exported successfully', 'success');
        }

        // Populate employee dropdowns
        function populateEmployeeSelects() {
            const taskAssignee = document.getElementById('taskAssignee');
            const employeeSelect = document.getElementById('employeeSelect');
            
            // Clear existing options
            if (taskAssignee) taskAssignee.innerHTML = '';
            if (employeeSelect) employeeSelect.innerHTML = '';
            
            // Add options for each employee
            staffData.employees.forEach(employee => {
                if (taskAssignee) {
                    const option = document.createElement('option');
                    option.value = employee.id;
                    option.textContent = employee.name;
                    taskAssignee.appendChild(option);
                }
                
                if (employeeSelect) {
                    const option2 = document.createElement('option');
                    option2.value = employee.id;
                    option2.textContent = employee.name;
                    employeeSelect.appendChild(option2);
                }
            });
        }

        // Function to update unit options based on category
        function updateUnitOptions(category) {
            const unitSelect = document.getElementById('inventoryUnit');
            const unitDisplay = document.getElementById('unitDisplay');
            const thresholdUnitDisplay = document.getElementById('thresholdUnitDisplay');
            const maxStockUnitDisplay = document.getElementById('maxStockUnitDisplay');
            
            if (!unitSelect) return;
            
            // Clear existing options
            unitSelect.innerHTML = '';
            
            // Get units for the selected category, with fallback
            const units = unitOptions[category] || unitOptions.supplies;
            
            // Add new options
            units.forEach(unit => {
                const option = document.createElement('option');
                option.value = unit.value;
                option.textContent = unit.label;
                unitSelect.appendChild(option);
            });
            
            // Set default unit display
            if (units.length > 0) {
                const defaultUnit = units[0].value;
                unitSelect.value = defaultUnit;
                if (unitDisplay) unitDisplay.textContent = defaultUnit;
                if (thresholdUnitDisplay) thresholdUnitDisplay.textContent = defaultUnit;
                if (maxStockUnitDisplay) maxStockUnitDisplay.textContent = defaultUnit;
            }
        }

        // Enhanced version with safety check:
        function renderDailyChecklist() {
            const checklistContainer = document.getElementById('dailyChecklist');
            if (!checklistContainer) return;
            
            checklistContainer.innerHTML = '';
            
            staffData.operations.checklist.forEach(task => {
                const taskItem = document.createElement('li');
                taskItem.className = `task-item ${task.completed ? 'completed' : ''}`;
                taskItem.dataset.taskId = task.id;
                
                // Use task.name with fallback to handle any data issues
                const taskName = task.name || task.text || `Task ${task.id}`;
                
                taskItem.innerHTML = `
                    <div class="task-checkbox">${task.completed ? '<i class="fas fa-check"></i>' : ''}</div>
                    <div class="task-content">
                        <div class="task-title">${taskName}</div>
                        <span class="task-status">${task.completed ? 'Completed' : 'Pending'}</span>
                    </div>
                `;
                
                checklistContainer.appendChild(taskItem);
            });
            
            // Reattach event listeners
            setupTaskChecklist();
        }
        
        // Render the equipment status
        function renderEquipmentStatus() {
            const equipmentContainer = document.getElementById('equipmentStatus');
            if (!equipmentContainer) return;
            
            equipmentContainer.innerHTML = '';
            
            staffData.operations.equipment.forEach(equipment => {
                const equipmentItem = document.createElement('li');
                equipmentItem.className = 'equipment-item';
                equipmentItem.dataset.equipmentId = equipment.id;
                
                equipmentItem.innerHTML = `
                    <span>${equipment.name}</span>
                    <span class="equipment-status ${equipment.status === 'Operational' ? 'operational' : 
                                                equipment.status === 'Needs Attention' ? 'needs-cleaning' : 
                                                'needs-maintenance'}">${equipment.status}</span>
                `;
                
                equipmentContainer.appendChild(equipmentItem);
            });
            
            // Reattach event listeners
            setupEquipmentStatus();
        }

        // Update completion statistics
        function updateCompletionStats() {
            const completedCount = document.querySelectorAll('#dailyChecklist .task-item.completed').length;
            const totalCount = document.querySelectorAll('#dailyChecklist .task-item').length;
            const percentage = Math.round((completedCount / totalCount) * 100);
            
            const completionCountElement = document.getElementById('completionCount');
            const completionPercentageElement = document.getElementById('completionPercentage');
            
            if (completionCountElement) {
                completionCountElement.textContent = `${completedCount}/${totalCount} tasks completed`;
            }
            
            if (completionPercentageElement) {
                completionPercentageElement.textContent = `${percentage}%`;
            }
        }

        // Reset the daily checklist
        function resetDailyChecklist() {
            if (confirm('Are you sure you want to reset all checklist items?')) {
                staffData.operations.checklist.forEach(task => {
                    task.completed = false;
                });
                renderDailyChecklist();
                updateCompletionStats();
                saveOperationsData();
                showNotification('Daily checklist has been reset!', 'info');
            }
        }

        // Reset all equipment status to operational
        function resetEquipmentStatus() {
            if (confirm('Are you sure you want to reset all equipment status to operational?')) {
                staffData.operations.equipment.forEach(equipment => {
                    equipment.status = 'Operational';
                });
                renderEquipmentStatus();
                saveOperationsData();
                showNotification('All equipment status has been reset to operational!', 'info');
            }
        }

        // Render time clock table with Actions column
        function renderTimeClock() {
            const tbody = document.querySelector('#timeClockTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            staffData.timeClock.forEach(entry => {
                const employee = staffData.employees.find(emp => emp.id === entry.employeeId);
                const row = document.createElement('tr');
                
                // Determine status automatically based on clock in/out
                let status = "Absent";
                let statusClass = "badge-danger";
                
                if (entry.clockIn && !entry.clockOut) {
                    status = "On Duty";
                    statusClass = "badge-success";
                } else if (entry.clockIn && entry.clockOut) {
                    status = "Completed";
                    statusClass = "badge-info";
                }
                
                // Update the entry status
                entry.status = status;
                
                row.innerHTML = `
                    <td>${employee ? employee.name : 'Unknown Employee'}</td>
                    <td>${entry.shift}</td>
                    <td>${formatTime(entry.clockIn)}</td>
                    <td>${formatTime(entry.clockOut)}</td>
                    <td><span class="badge ${statusClass}">${status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit edit-time-btn" data-entry-id="${entry.id}">Edit</button>
                            <button class="action-btn delete delete-time-btn" data-entry-id="${entry.id}">Delete</button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            updateStaffDashboard();
            renderTodaySchedule();
        }

        // Update the renderTimeClockDashboard function to handle avatar display:
        function renderTimeClockDashboard() {
            const timeClockList = document.getElementById('timeClockDashboard');
            if (!timeClockList) return;
            
            timeClockList.innerHTML = '';
            
            // Get today's date for reference
            const today = new Date().toLocaleDateString('en-US', { weekday: 'short' }).toUpperCase().substring(0, 3);
            
            // Combine time clock entries with schedule information
            const combinedList = [];
            
            // First, add time clock entries
            staffData.timeClock.forEach(entry => {
                const employee = staffData.employees.find(emp => emp.id === entry.employeeId);
                if (employee) {
                    combinedList.push({
                        type: 'timeClock',
                        employeeId: employee.id,
                        name: employee.name,
                        avatar: employee.avatar || getInitials(employee.name),
                        shift: entry.shift,
                        status: entry.status,
                        clockIn: entry.clockIn,
                        clockOut: entry.clockOut
                    });
                }
            });
            
            // Then add employees with today's schedule but no time clock entry
            const todaySchedules = staffData.schedules.filter(s => s.day === today);
            todaySchedules.forEach(schedule => {
                const employee = staffData.employees.find(emp => emp.id === schedule.employeeId);
                const hasTimeClock = staffData.timeClock.some(tc => tc.employeeId === schedule.employeeId);
                
                if (employee && !hasTimeClock) {
                    combinedList.push({
                        type: 'schedule',
                        employeeId: employee.id,
                        name: employee.name,
                        avatar: employee.avatar || getInitials(employee.name),
                        shift: `${schedule.start}-${schedule.end}`,
                        status: 'Scheduled',
                        clockIn: '',
                        clockOut: ''
                    });
                }
            });
            
            // Render the combined list
            combinedList.forEach(entry => {
                const li = document.createElement('li');
                li.className = 'staff-item';
                
                // Get avatar text (initials)
                const avatarText = entry.avatar || getInitials(entry.name);
                
                li.innerHTML = `
                    <div class="staff-avatar">${avatarText}</div>
                    <div class="staff-details">
                        <div class="staff-name">${entry.name || 'Unknown Employee'}</div>
                        <div class="staff-role">${entry.shift} — ${entry.status || 'Not Clocked In'}</div>
                    </div>
                `;
                timeClockList.appendChild(li);
            });
        }

        function renderCustomerFeedback() {
            const ratings = JSON.parse(localStorage.getItem('bistroRatings')) || [];
            const avgEl = document.getElementById('avgRatingStat');
            const pendingEl = document.getElementById('pendingIssuesStat');
            const listEl = document.getElementById('feedbackList');
            if (!avgEl || !pendingEl || !listEl) return;
            if (ratings.length === 0) {
                avgEl.textContent = '0.0';
                pendingEl.textContent = '0';
                listEl.innerHTML = '<div class="feedback-item"><div class="feedback-comment">No feedback submitted yet</div></div>';
                return;
            }
            const avg = (ratings.reduce((t, r) => t + (r.rating || 0), 0) / ratings.length).toFixed(1);
            const pending = ratings.filter(r => (r.rating || 0) <= 2).length;
            avgEl.textContent = String(avg);
            pendingEl.textContent = String(pending);
            listEl.innerHTML = '';
            const recent = ratings.slice(-5).reverse();
            recent.forEach(r => {
                const item = document.createElement('div');
                item.className = 'feedback-item';
                const starsHtml = Array.from({ length: 5 }, (_, i) => i < (r.rating || 0) ? '<i class="fas fa-star"></i>' : '<i class="far fa-star"></i>').join('');
                const comment = r.feedback && r.feedback.length > 0 ? r.feedback : 'No comment provided';
                const dateStr = r.date ? new Date(r.date).toLocaleString() : '';
                item.innerHTML = `
                    <div class="feedback-rating">${starsHtml}</div>
                    <div class="feedback-comment">${comment}</div>
                    <div class="feedback-date">${dateStr}</div>
                `;
                listEl.appendChild(item);
            });
        }

        function getTodayCode() {
            const map = ['SUN','MON','TUE','WED','THU','FRI','SAT'];
            return map[new Date().getDay()];
        }

        function parseTimeToMinutes(t) {
            if (!t) return null;
            const parts = t.split(':');
            const h = parseInt(parts[0],10);
            const m = parseInt(parts[1],10);
            return h*60 + m;
        }

        function nowMinutes() {
            const d = new Date();
            return d.getHours()*60 + d.getMinutes();
        }

        function updateStaffDashboard() {
            const today = getTodayCode();
            const timeClockList = document.getElementById('timeClockDashboard');
            const staffOnDutyList = document.getElementById('staffOnDutyDashboard');
            if (!timeClockList || !staffOnDutyList) return;
            
            // Time Clock summary
            timeClockList.innerHTML = '';
            staffData.timeClock.forEach(entry => {
                const emp = staffData.employees.find(e => e.id === entry.employeeId);
                const li = document.createElement('li');
                li.className = 'staff-item';
                
                // Fix: Get proper avatar text
                let avatarText = 'NA';
                if (emp) {
                    avatarText = emp.avatar || getInitials(emp.name);
                }
                
                li.innerHTML = `
                    <div class="staff-avatar">${avatarText}</div>
                    <div class="staff-details">
                        <div class="staff-name">${emp ? emp.name : 'Unknown Employee'}</div>
                        <div class="staff-role">${entry.shift} — ${entry.status || 'Absent'}</div>
                    </div>
                `;
                timeClockList.appendChild(li);
            });
            
            // Staff On Duty based on schedule and current time
            staffOnDutyList.innerHTML = '';
            const schedulesToday = staffData.schedules.filter(s => s.day === today);
            const nowMin = nowMinutes();
            const onDutyIds = [];
            schedulesToday.forEach(s => {
                const startMin = parseTimeToMinutes(s.start);
                const endMin = parseTimeToMinutes(s.end);
                if (startMin != null && endMin != null && nowMin >= startMin && nowMin <= endMin) {
                    const emp = staffData.employees.find(e => e.id === s.employeeId);
                    const li = document.createElement('li');
                    li.className = 'staff-item';
                    
                    // Fix: Get proper avatar text
                    let avatarText = 'NA';
                    if (emp) {
                        avatarText = emp.avatar || getInitials(emp.name);
                    }
                    
                    li.innerHTML = `
                        <div class="staff-avatar">${avatarText}</div>
                        <div class="staff-details">
                            <div class="staff-name">${emp ? emp.name : 'Unknown'}</div>
                            <div class="staff-role">On duty (${s.start}-${s.end})</div>
                        </div>
                    `;
                    staffOnDutyList.appendChild(li);
                    onDutyIds.push(s.employeeId);
                }
            });
        }

        function renderTodaySchedule() {
            const todayList = document.getElementById('todayScheduleList');
            if (!todayList) return;
            todayList.innerHTML = '';
            const today = getTodayCode();
            const todaysSchedules = staffData.schedules.filter(s => s.day === today);
            if (todaysSchedules.length === 0) {
                const li = document.createElement('li');
                li.className = 'staff-item';
                li.innerHTML = `<div class="staff-details"><div class="staff-name">No schedules for today</div></div>`;
                todayList.appendChild(li);
                return;
            }
            todaysSchedules.forEach(s => {
                const emp = staffData.employees.find(e => e.id === s.employeeId);
                const li = document.createElement('li');
                li.className = 'staff-item';
                
                // Fix: Get proper avatar text
                let avatarText = 'NA';
                if (emp) {
                    avatarText = emp.avatar || getInitials(emp.name);
                }
                
                li.innerHTML = `
                    <div class="staff-avatar">${avatarText}</div>
                    <div class="staff-details">
                        <div class="staff-name">${emp ? emp.name : 'Unknown'}</div>
                        <div class="staff-role">${emp && emp.role ? emp.role : 'Scheduled'} (${s.start}-${s.end})</div>
                    </div>
                `;
                todayList.appendChild(li);
            });
        }

        // Render tasks
        function renderTasks() {
            const openTasksContainer = document.getElementById('openTasksContainer');
            const completedTasksContainer = document.getElementById('completedTasksContainer');
            
            if (!openTasksContainer || !completedTasksContainer) return;
            
            openTasksContainer.innerHTML = '';
            completedTasksContainer.innerHTML = '';
            
            staffData.tasks.forEach(task => {
                const employee = staffData.employees.find(emp => emp.id === task.assigneeId);
                const taskCard = document.createElement('div');
                taskCard.className = 'task-item';
                taskCard.dataset.taskId = task.id;
                
                // Add completed class for styling
                if (task.completed) {
                    taskCard.classList.add('completed');
                }
                
                taskCard.innerHTML = `
                    <div class="task-checkbox">${task.completed ? '<i class="fas fa-check"></i>' : ''}</div>
                    <div class="task-content">
                        <div class="task-title">${task.title}</div>
                        <div class="task-meta">
                            <span><i class="fas fa-user"></i> ${employee ? employee.name : 'Unknown'}</span>
                            <span><i class="far fa-clock"></i> Due: ${formatDate(task.dueDate)} at ${formatTime(task.dueTime)}</span>
                        </div>
                        <span class="task-status ${task.completed ? 'completed' : 'pending'}">${task.completed ? 'Completed' : 'In Progress'}</span>
                        <div class="action-buttons" style="margin-top: 0.5rem;">
                            <button class="action-btn edit edit-task-btn">Edit</button>
                            <button class="action-btn delete delete-task-btn">Delete</button>
                        </div>
                    </div>
                `;
                
                // Add event listeners for edit and delete buttons
                const editBtn = taskCard.querySelector('.edit-task-btn');
                const deleteBtn = taskCard.querySelector('.delete-task-btn');
                
                editBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    editTask(task.id);
                });
                
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (confirm('Are you sure you want to delete this task?')) {
                        staffData.tasks = staffData.tasks.filter(t => t.id !== task.id);
                        renderTasks();
                        showNotification('Task deleted successfully!', 'success');
                    }
                });
                
                // Add click to toggle completion
                taskCard.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('edit-task-btn') && !e.target.classList.contains('delete-task-btn')) {
                        task.completed = !task.completed;
                        renderTasks();
                        showNotification(`Task marked as ${task.completed ? 'completed' : 'incomplete'}!`, 'success');
                    }
                });
                
                if (task.completed) {
                    completedTasksContainer.appendChild(taskCard);
                } else {
                    openTasksContainer.appendChild(taskCard);
                }
            });
        }

        // Render inventory
        function renderInventory() {
            const coffeeList = document.getElementById('coffeeInventoryList');
            const dairyList = document.getElementById('dairyInventoryList');
            const foodList = document.getElementById('foodInventoryList');
            const supplyList = document.getElementById('supplyInventoryList');
            
            // Clear existing lists
            if (coffeeList) coffeeList.innerHTML = '';
            if (dairyList) dairyList.innerHTML = '';
            if (foodList) foodList.innerHTML = '';
            if (supplyList) supplyList.innerHTML = '';
            
            staffData.inventory.forEach(item => {
                // Calculate current status
                const status = updateInventoryStatusDisplay(item);
                
                const inventoryItem = document.createElement('div');
                inventoryItem.className = 'inventory-item';
                inventoryItem.dataset.inventoryId = item.id;
                
                inventoryItem.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1rem; flex: 1;">
                        <div class="inventory-icon">
                            <i class="fas fa-${getInventoryIcon(item.category)}"></i>
                        </div>
                        <div>
                            <div style="font-weight: 500;">${item.name}</div>
                            <div style="font-size: 0.85rem; color: var(--text-tertiary);">${item.stock} ${item.unit}</div>
                        </div>
                    </div>
                    <div style="width: 100px; height: 8px; background: var(--border-light); border-radius: 4px; overflow: hidden;">
                        <div class="level-fill ${status.level}" style="width: ${status.percentage}%"></div>
                    </div>
                    <div style="font-size: 0.85rem; font-weight: 500; color: ${getStatusColor(status.level)};">
                        ${status.status}
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn edit edit-inventory-btn">Edit</button>
                        <button class="action-btn delete delete-inventory-btn">Delete</button>
                    </div>
                `;
                
                // Add event listeners
                const editBtn = inventoryItem.querySelector('.edit-inventory-btn');
                const deleteBtn = inventoryItem.querySelector('.delete-inventory-btn');
                
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    editInventory(item.id);
                });
                
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (confirm(`Are you sure you want to delete ${item.name}?`)) {
                        deleteInventoryItem(item.id);
                    }
                });
                
                // Add to appropriate category
                switch(item.category) {
                    case 'coffee':
                        if (coffeeList) coffeeList.appendChild(inventoryItem);
                        break;
                    case 'dairy':
                        if (dairyList) dairyList.appendChild(inventoryItem);
                        break;
                    case 'food':
                        if (foodList) foodList.appendChild(inventoryItem);
                        break;
                    case 'supplies':
                        if (supplyList) supplyList.appendChild(inventoryItem);
                        break;
                    default:
                        // Fallback: if category doesn't match, add to supplies
                        if (supplyList) supplyList.appendChild(inventoryItem);
                }
            });
            
            // Update inventory stats and alerts
            updateInventoryStats();
            updateInventoryAlerts();
        }

        function getInventoryIcon(category) {
            const icons = {
                'coffee': 'coffee',
                'dairy': 'wine-bottle',
                'food': 'cookie',
                'supplies': 'box'
            };
            return icons[category] || 'box';
        }

        function getStatusColor(level) {
            const colors = {
                'low': 'var(--danger)',
                'medium': 'var(--warning)',
                'high': 'var(--info)',
                'full': 'var(--success)'
            };
            return colors[level] || 'var(--text-tertiary)';
        }

        // Function to delete inventory item
        function deleteInventoryItem(inventoryId) {
            staffData.inventory = staffData.inventory.filter(i => i.id !== inventoryId);
            
            // Re-render inventory
            renderInventory();
            
            showNotification('Inventory item deleted successfully!', 'success');
        }

        // Render inventory updates
        function renderInventoryUpdates() {
            const tbody = document.querySelector('#inventoryUpdatesTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            staffData.inventoryUpdates.forEach(update => {
                const row = document.createElement('tr');
                row.className = 'editable-row';
                row.dataset.updateId = update.id;
                
                row.innerHTML = `
                    <td>${update.item}</td>
                    <td>${update.updatedBy}</td>
                    <td>${formatDate(update.date)} at ${formatTime(update.time)}</td>
                    <td>${update.change}</td>
                    <td><span class="badge ${update.newLevel === 'Low' ? 'badge-danger' : update.newLevel === 'Medium' ? 'badge-warning' : 'badge-success'}">${update.newLevel}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit edit-inventory-update-btn" data-update-id="${update.id}">Edit</button>
                            <button class="action-btn delete delete-inventory-update-btn" data-update-id="${update.id}">Delete</button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Render inventory audits
        function renderInventoryAudits() {
            const tbody = document.querySelector('#inventoryAuditsTable tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            staffData.inventoryAudits.forEach(audit => {
                const row = document.createElement('tr');
                row.dataset.auditId = audit.id;
                
                // Determine status badge class
                let statusClass = 'badge-info';
                if (audit.status === 'Completed') statusClass = 'badge-success';
                else if (audit.status === 'In Progress') statusClass = 'badge-warning';
                else if (audit.status === 'Pending') statusClass = 'badge-secondary';
                
                row.innerHTML = `
                    <td>#${audit.id.toString().padStart(3, '0')}</td>
                    <td>${formatDate(audit.date)}<br><small>${audit.time}</small></td>
                    <td>${audit.auditor}</td>
                    <td>${audit.items ? audit.items.length : 0} items</td>
                    <td>
                        <span style="color: ${audit.discrepancies > 0 ? 'var(--danger)' : 'var(--success)'}">
                            ${audit.discrepancies || 0}
                        </span>
                    </td>
                    <td><span class="badge ${statusClass}">${audit.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn view view-audit-btn" data-audit-id="${audit.id}">View</button>
                            <button class="action-btn edit edit-audit-btn" data-audit-id="${audit.id}">Edit</button>
                            <button class="action-btn delete delete-audit-btn" data-audit-id="${audit.id}">Delete</button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
            
            // Add event listeners for the new buttons
            addAuditEventListeners();
        }

        // Add audit event listeners
        function addAuditEventListeners() {
            document.querySelectorAll('.view-audit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const auditId = parseInt(this.dataset.auditId);
                    viewInventoryAudit(auditId);
                });
            });
            
            document.querySelectorAll('.edit-audit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const auditId = parseInt(this.dataset.auditId);
                    editInventoryAudit(auditId);
                });
            });
            
            document.querySelectorAll('.delete-audit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const auditId = parseInt(this.dataset.auditId);
                    deleteInventoryAudit(auditId);
                });
            });
        }

        // Enhanced updateInventoryStats function
        function updateInventoryStats() {
            const statsContainer = document.getElementById('inventoryStats');
            if (!statsContainer) return;
            
            // Calculate statistics
            const totalItems = staffData.inventory.length;
            const lowStockItems = staffData.inventory.filter(item => 
                calculateStockLevel(item) === 'low' || item.stock === 0
            ).length;
            
            const outOfStockItems = staffData.inventory.filter(item => 
                item.stock === 0
            ).length;
            
            // Update the stats display
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-card-value">${totalItems}</div>
                    <div class="stat-card-label">Total Items</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-value">${lowStockItems}</div>
                    <div class="stat-card-label">Low Stock</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-value">${outOfStockItems}</div>
                    <div class="stat-card-label">Out of Stock</div>
                </div>
            `;
        }

        // Enhanced updateInventoryAlerts function
        function updateInventoryAlerts() {
            const alertsContainer = document.querySelector('.inventory-alerts');
            if (!alertsContainer) return;
            
            // Create alerts container if it doesn't exist
            const inventoryTab = document.getElementById('inventory');
            if (!inventoryTab.querySelector('.inventory-alerts')) {
                const alertsDiv = document.createElement('div');
                alertsDiv.className = 'inventory-alerts';
                alertsDiv.innerHTML = '<h3 class="section-title">Inventory Alerts</h3>';
                inventoryTab.insertBefore(alertsDiv, inventoryTab.querySelector('.inventory-coordination-grid'));
            }
            
            // Clear existing alerts
            const alertsContainerUpdated = document.querySelector('.inventory-alerts');
            alertsContainerUpdated.innerHTML = '<h3 class="section-title">Inventory Alerts</h3>';
            
            // Check for critical items (out of stock)
            const outOfStockItems = staffData.inventory.filter(item => item.stock === 0);
            outOfStockItems.forEach(item => {
                const alertItem = document.createElement('div');
                alertItem.className = 'alert alert-danger';
                alertItem.innerHTML = `
                    <div class="alert-icon">🚨</div>
                    <div><strong>CRITICAL:</strong> ${item.name} is out of stock! Urgent reorder needed.</div>
                `;
                alertsContainerUpdated.appendChild(alertItem);
            });
            
            // Check for low stock items
            const lowStockItems = staffData.inventory.filter(item => 
                calculateStockLevel(item) === 'low' && item.stock > 0 && item.stock <= item.minLevel
            );
            lowStockItems.forEach(item => {
                const alertItem = document.createElement('div');
                alertItem.className = 'alert alert-warning';
                alertItem.innerHTML = `
                    <div class="alert-icon">⚠️</div>
                    <div><strong>LOW STOCK:</strong> ${item.name} is below reorder threshold (${item.stock} ${item.unit} remaining)</div>
                `;
                alertsContainerUpdated.appendChild(alertItem);
            });
            
            // Show all good message if no alerts
            if (outOfStockItems.length === 0 && lowStockItems.length === 0) {
                const alertItem = document.createElement('div');
                alertItem.className = 'alert alert-success';
                alertItem.innerHTML = `
                    <div class="alert-icon">✅</div>
                    <div>All inventory levels are satisfactory. No urgent alerts.</div>
                `;
                alertsContainerUpdated.appendChild(alertItem);
            }
        }

        // Function to update inventory status display
        function updateInventoryStatusDisplay(item) {
            const percentage = (item.stock / item.maxLevel) * 100;
            let level = "low";
            let status = "Low";
            
            if (percentage <= 20) {
                level = "low";
                status = "Low";
            } else if (percentage <= 50) {
                level = "medium";
                status = "Medium";
            } else if (percentage <= 80) {
                level = "high";
                status = "High";
            } else {
                level = "full";
                status = "Full";
            }
            
            // Update the item with calculated status
            item.level = level;
            item.status = status;
            
            return {
                level: level,
                status: status,
                percentage: percentage
            };
        }

        function calculateStockLevel(item) {
            if (!item.maxLevel || item.maxLevel === 0) return "low";
            const percentage = (item.stock / item.maxLevel) * 100;
            if (percentage <= 20) return "low";
            else if (percentage <= 50) return "medium";
            else if (percentage <= 80) return "high";
            else return "full";
        }

        // Function to update the stock level status display based on current values
        function updateStockLevelStatusDisplay(item = null) {
            const statusDisplay = document.getElementById('stockLevelStatusDisplay');
            if (!statusDisplay) return;
            
            if (!item) {
                // Get values from form if no item provided
                const quantity = parseFloat(document.getElementById('inventoryQuantity').value) || 0;
                const maximumStock = parseFloat(document.getElementById('inventoryMaximumStock').value) || 1;
                const unit = document.getElementById('unitDisplay').textContent;
                
                item = {
                    stock: quantity,
                    maxLevel: maximumStock,
                    unit: unit
                };
            }
            
            const percentage = (item.stock / item.maxLevel) * 100;
            let statusText = '';
            let statusColor = '';
            
            if (percentage <= 20) {
                statusText = `Low (${percentage.toFixed(1)}%)`;
                statusColor = 'var(--danger)';
            } else if (percentage <= 50) {
                statusText = `Medium (${percentage.toFixed(1)}%)`;
                statusColor = 'var(--warning)';
            } else if (percentage <= 80) {
                statusText = `High (${percentage.toFixed(1)}%)`;
                statusColor = 'var(--info)';
            } else {
                statusText = `Full (${percentage.toFixed(1)}%)`;
                statusColor = 'var(--success)';
            }
            
            statusDisplay.textContent = `${statusText} - ${item.stock} ${item.unit} of ${item.maxLevel} ${item.unit}`;
            statusDisplay.style.backgroundColor = statusColor;
            statusDisplay.style.color = 'white';
        }

        // Edit schedule
        function editSchedule(employeeId, day) {
            currentEditing.employee = employeeId;
            currentEditing.day = day;
            
            const employee = staffData.employees.find(emp => emp.id === parseInt(employeeId));
            
            document.getElementById('editScheduleTitle').textContent = `Edit Schedule for ${employee ? employee.name : 'Unknown Employee'}`;
            
            // Show display fields and hide select fields for editing
            document.getElementById('employeeDisplayGroup').style.display = 'block';
            document.getElementById('employeeSelectGroup').style.display = 'none';
            document.getElementById('dayDisplayGroup').style.display = 'block';
            document.getElementById('daySelectGroup').style.display = 'none';
            
            let employeeInfo = employee ? employee.name : 'Unknown Employee';
            
            document.getElementById('employeeNameDisplay').value = employeeInfo;
            document.getElementById('dayDisplay').value = day;
            
            const schedule = staffData.schedules.find(s => 
                s.employeeId === parseInt(employeeId) && s.day === day
            );
            
            if (schedule) {
                document.getElementById('shiftStart').value = schedule.start;
                document.getElementById('shiftEnd').value = schedule.end;
            } else {
                document.getElementById('shiftStart').value = "09:00";
                document.getElementById('shiftEnd').value = "17:00";
            }
            
            document.getElementById('editScheduleModal').style.display = 'block';
        }

        // Edit task
        function editTask(taskId) {
            const task = staffData.tasks.find(t => t.id === taskId);
            if (!task) return;
            
            currentEditing.task = taskId;
            
            document.getElementById('editTaskTitle').textContent = `Edit Task: ${task.title}`;
            document.getElementById('taskTitleInput').value = task.title;
            document.getElementById('taskAssignee').value = task.assigneeId;
            document.getElementById('taskDueDate').value = task.dueDate;
            document.getElementById('taskDueTime').value = task.dueTime;
            document.getElementById('taskCompleted').checked = task.completed;
            
            document.getElementById('editTaskModal').style.display = 'block';
        }

        // Enhanced edit inventory function
        function editInventory(inventoryId) {
            const item = staffData.inventory.find(i => i.id === inventoryId);
            if (!item) return;
            
            currentEditing.inventory = inventoryId;
            
            document.getElementById('editInventoryTitle').textContent = `Edit Inventory: ${item.name}`;
            document.getElementById('inventoryItem').value = item.name;
            document.getElementById('inventoryCategory').value = item.category;
            document.getElementById('inventoryQuantity').value = item.stock || '';
            document.getElementById('inventoryMaximumStock').value = item.maxLevel || '';
            document.getElementById('inventoryThreshold').value = item.minLevel || '';
            
            // Update unit options based on category
            updateUnitOptions(item.category);
            
            // Set the current unit
            if (item.unit) {
                document.getElementById('inventoryUnit').value = item.unit;
                document.getElementById('unitDisplay').textContent = item.unit;
                document.getElementById('thresholdUnitDisplay').textContent = item.unit;
                document.getElementById('maxStockUnitDisplay').textContent = item.unit;
            }
            
            // Calculate and display current stock level status
            updateStockLevelStatusDisplay(item);
            
            document.getElementById('editInventoryModal').style.display = 'block';
        }

        // Edit inventory update
        function editInventoryUpdate(updateId) {
            const update = staffData.inventoryUpdates.find(u => u.id === updateId);
            if (!update) return;
            
            currentEditing.inventoryUpdate = updateId;
            
            // Note: This modal doesn't exist in the HTML yet, you would need to add it
            // For now, we'll just show a notification
            showNotification('Edit inventory update functionality coming soon!', 'info');
        }

        // View inventory audit
        function viewInventoryAudit(auditId) {
            const audit = staffData.inventoryAudits.find(a => a.id === auditId);
            if (!audit) return;
            
            openInventoryAuditModal(audit, true);
        }

        // Edit inventory audit
        function editInventoryAudit(auditId) {
            const audit = staffData.inventoryAudits.find(a => a.id === auditId);
            if (!audit) return;
            
            currentEditing.inventoryAudit = auditId;
            openInventoryAuditModal(audit, false);
        }

        // Open inventory audit modal
        function openInventoryAuditModal(audit, viewOnly = false) {
            const modal = document.getElementById('inventoryAuditModal');
            const title = document.getElementById('inventoryAuditTitle');
            const auditDate = document.getElementById('auditDate');
            const auditTime = document.getElementById('auditTime');
            const auditAuditor = document.getElementById('auditAuditor');
            const auditNotes = document.getElementById('auditNotes');
            const auditItemsContainer = document.getElementById('auditItemsContainer');
            const saveAuditBtn = document.getElementById('saveAuditBtn');
            const deleteAuditBtn = document.getElementById('deleteAuditBtn');
            const completeAuditBtn = document.getElementById('completeAuditBtn');
            const addAuditItemBtn = document.getElementById('addAuditItemBtn');
            
            if (viewOnly) {
                title.textContent = `View Audit #${audit.id.toString().padStart(3, '0')}`;
                saveAuditBtn.style.display = 'none';
                deleteAuditBtn.style.display = 'none';
                completeAuditBtn.style.display = 'none';
                addAuditItemBtn.style.display = 'none';
                
                // Make all fields read-only
                document.querySelectorAll('#inventoryAuditModal input, #inventoryAuditModal textarea, #inventoryAuditModal select').forEach(el => {
                    el.readOnly = true;
                    el.disabled = true;
                });
            } else {
                title.textContent = audit.id ? `Edit Audit #${audit.id.toString().padStart(3, '0')}` : 'New Inventory Audit';
                saveAuditBtn.style.display = 'inline-block';
                deleteAuditBtn.style.display = audit.id ? 'inline-block' : 'none';
                completeAuditBtn.style.display = 'inline-block';
                addAuditItemBtn.style.display = 'inline-block';
                
                // Make all fields editable
                document.querySelectorAll('#inventoryAuditModal input, #inventoryAuditModal textarea, #inventoryAuditModal select').forEach(el => {
                    el.readOnly = false;
                    el.disabled = false;
                });
            }
            
            // Populate form
            auditDate.value = audit.date || new Date().toISOString().split('T')[0];
            auditTime.value = audit.time || new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            auditAuditor.value = audit.auditor || 'Supervisor';
            auditNotes.value = audit.notes || '';
            
            // Clear and populate audit items
            auditItemsContainer.innerHTML = '';
            
            if (audit.items && audit.items.length > 0) {
                audit.items.forEach((item, index) => {
                    addAuditItemRow(item, index, viewOnly);
                });
            }
            
            // Update audit summary
            updateAuditSummary(audit);
            
            // Show modal
            modal.style.display = 'block';
            
            // Add event listeners for modal buttons
            setupAuditModalEventListeners(audit, viewOnly);
        }

        // Add audit item row
        function addAuditItemRow(item = null, index = 0, viewOnly = false) {
            const container = document.getElementById('auditItemsContainer');
            const itemId = item ? item.itemId : '';
            const itemName = item ? item.itemName : '';
            const expected = item ? item.expected : 0;
            const actual = item ? item.actual : 0;
            const discrepancy = item ? item.discrepancy : 0;
            const notes = item ? item.notes : '';
            
            const row = document.createElement('div');
            row.className = 'audit-item-row form-row';
            row.style.marginBottom = '0.5rem';
            row.style.padding = '0.5rem';
            row.style.backgroundColor = '#f8f9fa';
            row.style.borderRadius = '5px';
            
            row.innerHTML = `
                <div class="form-group" style="flex: 2;">
                    <label>Item</label>
                    <select class="form-control audit-item-select" ${viewOnly ? 'disabled' : ''}>
                        <option value="">Select Item</option>
                        ${staffData.inventory.map(inv => 
                            `<option value="${inv.id}" data-name="${inv.name}" data-unit="${inv.unit}" ${inv.id === itemId ? 'selected' : ''}>
                                ${inv.name} (Current: ${inv.stock} ${inv.unit})
                            </option>`
                        ).join('')}
                    </select>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Expected</label>
                    <input type="number" class="form-control audit-expected" value="${expected}" step="0.01" ${viewOnly ? 'readonly' : ''}>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Actual Count</label>
                    <input type="number" class="form-control audit-actual" value="${actual}" step="0.01" ${viewOnly ? 'readonly' : ''}>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Discrepancy</label>
                    <input type="text" class="form-control audit-discrepancy" value="${discrepancy}" readonly>
                </div>
                <div class="form-group" style="flex: 1; margin-top: 1.5rem;">
                    ${viewOnly ? '' : '<button class="btn btn-danger btn-sm remove-audit-item-btn" type="button">×</button>'}
                </div>
                <div class="form-group" style="flex: 2;">
                    <label>Notes</label>
                    <input type="text" class="form-control audit-item-notes" value="${notes}" ${viewOnly ? 'readonly' : ''} placeholder="Enter notes...">
                </div>
            `;
            
            container.appendChild(row);
            
            // Add event listeners for dynamic calculations
            if (!viewOnly) {
                const expectedInput = row.querySelector('.audit-expected');
                const actualInput = row.querySelector('.audit-actual');
                const discrepancyInput = row.querySelector('.audit-discrepancy');
                const removeBtn = row.querySelector('.remove-audit-item-btn');
                const itemSelect = row.querySelector('.audit-item-select');
                
                // Calculate discrepancy on input change
                const calculateDiscrepancy = () => {
                    const expectedVal = parseFloat(expectedInput.value) || 0;
                    const actualVal = parseFloat(actualInput.value) || 0;
                    const discrepancyVal = actualVal - expectedVal;
                    
                    discrepancyInput.value = discrepancyVal;
                    discrepancyInput.className = 'form-control audit-discrepancy ' + 
                        (discrepancyVal < 0 ? 'text-danger' : discrepancyVal > 0 ? 'text-success' : 'text-muted');
                    
                    updateAuditSummary();
                };
                
                expectedInput.addEventListener('input', calculateDiscrepancy);
                actualInput.addEventListener('input', calculateDiscrepancy);
                
                // Auto-fill expected value when item is selected
                itemSelect.addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    const itemId = this.value;
                    if (itemId) {
                        const inventoryItem = staffData.inventory.find(i => i.id == itemId);
                        if (inventoryItem) {
                            expectedInput.value = inventoryItem.stock;
                            calculateDiscrepancy();
                        }
                    }
                });
                
                // Remove item
                removeBtn.addEventListener('click', function() {
                    row.remove();
                    updateAuditSummary();
                });
            }
        }

        // Update audit summary
        function updateAuditSummary(audit = null) {
            if (audit) {
                // Use provided audit data
                document.getElementById('auditTotalItems').textContent = audit.totalItems || 0;
                document.getElementById('auditItemsChecked').textContent = audit.itemsChecked || 0;
                document.getElementById('auditDiscrepancies').textContent = audit.discrepancies || 0;
                document.getElementById('auditAccuracy').textContent = audit.accuracyRate || '100%';
            } else {
                // Calculate from form
                const itemRows = document.querySelectorAll('.audit-item-row');
                const totalItems = itemRows.length;
                const itemsWithData = Array.from(itemRows).filter(row => {
                    const itemSelect = row.querySelector('.audit-item-select');
                    return itemSelect && itemSelect.value;
                }).length;
                
                const discrepancies = Array.from(itemRows).reduce((total, row) => {
                    const discrepancyInput = row.querySelector('.audit-discrepancy');
                    if (discrepancyInput) {
                        const discrepancy = parseFloat(discrepancyInput.value) || 0;
                        return total + (discrepancy !== 0 ? 1 : 0);
                    }
                    return total;
                }, 0);
                
                const accuracyRate = itemsWithData > 0 ? 
                    `${Math.round(((itemsWithData - discrepancies) / itemsWithData) * 100)}%` : 
                    '100%';
                
                document.getElementById('auditTotalItems').textContent = totalItems;
                document.getElementById('auditItemsChecked').textContent = itemsWithData;
                document.getElementById('auditDiscrepancies').textContent = discrepancies;
                document.getElementById('auditAccuracy').textContent = accuracyRate;
            }
        }

        // Setup audit modal event listeners
        function setupAuditModalEventListeners(audit, viewOnly) {
            // Add audit item button
            document.getElementById('addAuditItemBtn').addEventListener('click', function() {
                if (!viewOnly) {
                    addAuditItemRow();
                }
            });
            
            // Save audit button
            document.getElementById('saveAuditBtn').addEventListener('click', function() {
                saveInventoryAudit();
            });
            
            // Delete audit button
            document.getElementById('deleteAuditBtn').addEventListener('click', function() {
                if (audit.id) {
                    deleteInventoryAudit(audit.id);
                }
            });
            
            // Complete audit button
            document.getElementById('completeAuditBtn').addEventListener('click', function() {
                completeInventoryAudit(audit);
            });
        }

        // Edit time clock
        function editTimeClock(entryId) {
            const entry = staffData.timeClock.find(e => e.id === entryId);
            if (!entry) return;
            
            const employee = staffData.employees.find(emp => emp.id === entry.employeeId);
            
            document.getElementById('editTimeClockTitle').textContent = `Edit Time Clock: ${employee ? employee.name : 'Unknown Employee'}`;
            
            // Populate the form
            document.getElementById('timeClockEmployee').value = employee ? employee.name : 'Unknown Employee';
            document.getElementById('timeClockShift').value = entry.shift;
            document.getElementById('timeClockIn').value = entry.clockIn;
            document.getElementById('timeClockOut').value = entry.clockOut;
            
            // Store the current editing entry
            currentEditing.timeClock = entryId;
            
            // Show display field and hide select field for editing
            document.getElementById('timeClockEmployeeGroup').style.display = 'block';
            document.getElementById('timeClockEmployeeSelectGroup').style.display = 'none';
            
            // Show the modal
            document.getElementById('editTimeClockModal').style.display = 'block';
        }

        // Function to save time clock changes
        function saveTimeClock() {
            const entryId = currentEditing.timeClock;
            if (!entryId) return;
            
            const entry = staffData.timeClock.find(e => e.id === entryId);
            if (!entry) return;
            
            // Get updated values
            const clockIn = document.getElementById('timeClockIn').value;
            const clockOut = document.getElementById('timeClockOut').value;
            const shift = document.getElementById('timeClockShift').value;
            
            // Determine status automatically
            let status = "Absent";
            if (clockIn && !clockOut) {
                status = "On Duty";
            } else if (clockIn && clockOut) {
                status = "Completed";
            }
            
            // Update the entry
            entry.clockIn = clockIn;
            entry.clockOut = clockOut;
            entry.shift = shift;
            entry.status = status;
            
            // Re-render the time clock table
            renderTimeClock();
            
            // Save to localStorage
            saveSupervisorData();
            
            // Close the modal
            document.getElementById('editTimeClockModal').style.display = 'none';
            
            showNotification('Time clock updated successfully!', 'success');
        }

        // Function to create a new time clock entry
        function createTimeClockEntry() {
            // Generate a new ID
            const newId = staffData.timeClock.length > 0 ? Math.max(...staffData.timeClock.map(e => e.id)) + 1 : 1;
            
            document.getElementById('editTimeClockTitle').textContent = 'Create New Time Clock Entry';
            
            // Clear the form
            document.getElementById('timeClockEmployeeSelect').value = "";
            document.getElementById('timeClockShift').value = "";
            document.getElementById('timeClockIn').value = "";
            document.getElementById('timeClockOut').value = "";
            
            // Show text input instead of dropdown for employee name
            document.getElementById('timeClockEmployeeGroup').style.display = 'none';
            document.getElementById('timeClockEmployeeSelectGroup').style.display = 'block';
            
            // Store the new entry ID
            currentEditing.timeClock = newId;
            
            document.getElementById('editTimeClockModal').style.display = 'block';
        }

        // Function to save a new time clock entry
        function saveNewTimeClockEntry() {
            const employeeName = document.getElementById('timeClockEmployeeSelect').value.trim();
            const shift = document.getElementById('timeClockShift').value;
            const clockIn = document.getElementById('timeClockIn').value;
            const clockOut = document.getElementById('timeClockOut').value;
            
            if (!employeeName) {
                showNotification('Please enter an employee name', 'warning');
                return;
            }
            
            // Find or create employee
            let employee = staffData.employees.find(emp => emp.name.toLowerCase() === employeeName.toLowerCase());
            let employeeId;
            
            if (employee) {
                // Use existing employee ID
                employeeId = employee.id;
            } else {
                // Create a new employee with a unique ID
                const newEmployeeId = staffData.employees.length > 0 ? 
                    Math.max(...staffData.employees.map(e => e.id)) + 1 : 1;
                
                // Create new employee
                const newEmployee = {
                    id: newEmployeeId,
                    name: employeeName,
                    role: "Staff",
                    avatar: getInitials(employeeName)
                };
                
                staffData.employees.push(newEmployee);
                employeeId = newEmployeeId;
                
                // Update the employee dropdowns
                populateEmployeeSelects();
                
                showNotification(`New employee ${employeeName} added to the system`, 'success');
            }
            
            // Determine status automatically
            let status = "Absent";
            if (clockIn && !clockOut) {
                status = "On Duty";
            } else if (clockIn && clockOut) {
                status = "Completed";
            }
            
            const newId = currentEditing.timeClock;
            
            // Create new entry
            const newEntry = {
                id: newId,
                employeeId: employeeId,
                shift: shift,
                clockIn: clockIn,
                clockOut: clockOut,
                status: status
            };
            
            staffData.timeClock.push(newEntry);
            
            // Re-render the time clock table
            renderTimeClock();
            
            // Save to localStorage
            saveSupervisorData();
            
            document.getElementById('editTimeClockModal').style.display = 'none';
            showNotification('Time clock entry created successfully!', 'success');
        }

        // Function to delete a time clock entry
        function deleteTimeClockEntry(entryId) {
            if (confirm('Are you sure you want to delete this time clock entry?')) {
                staffData.timeClock = staffData.timeClock.filter(e => e.id !== entryId);
                
                renderTimeClock();
                saveSupervisorData();
                
                showNotification('Time clock entry deleted successfully!', 'success');
            }
        }

        // Enhanced create inventory item function with Maximum Stock Level
        function createInventoryItem(category) {
            // Generate a new ID
            const newId = staffData.inventory.length > 0 ? 
                Math.max(...staffData.inventory.map(i => i.id)) + 1 : 1;
            
            // Get default unit for category
            const defaultUnit = unitOptions[category] ? unitOptions[category][0].value : 'units';
            
            // Create a new inventory item with default values
            const newInventory = {
                id: newId,
                name: "New Item",
                category: category,
                unit: defaultUnit,
                stock: 0,
                maxLevel: 10,
                minLevel: 2,
                lastUpdated: new Date().toISOString().split('T')[0]
            };
            
            staffData.inventory.push(newInventory);
            currentEditing.inventory = newId;
            
            // Save to localStorage
            saveInventoryToLocalStorage();
            
            // Update the modal
            document.getElementById('editInventoryTitle').textContent = `Create New Inventory Item`;
            document.getElementById('inventoryItem').value = newInventory.name;
            document.getElementById('inventoryCategory').value = category;
            document.getElementById('inventoryQuantity').value = newInventory.stock;
            document.getElementById('inventoryMaximumStock').value = newInventory.maxLevel;
            document.getElementById('inventoryThreshold').value = newInventory.minLevel;
            
            // Update unit options
            updateUnitOptions(category);
            document.getElementById('inventoryUnit').value = defaultUnit;
            document.getElementById('unitDisplay').textContent = defaultUnit;
            document.getElementById('thresholdUnitDisplay').textContent = defaultUnit;
            document.getElementById('maxStockUnitDisplay').textContent = defaultUnit;
            
            // Update stock level status display
            updateStockLevelStatusDisplay(newInventory);
            
            // Show the modal
            document.getElementById('editInventoryModal').style.display = 'block';
        }

        // Add inventory button handlers
        function setupInventoryButtonHandlers() {
            // Add event listeners for the category add buttons
            const addCoffeeItem = document.getElementById('addCoffeeItem');
            if (addCoffeeItem) {
                addCoffeeItem.addEventListener('click', function() {
                    createInventoryItem('coffee');
                });
            }
            
            const addDairyItem = document.getElementById('addDairyItem');
            if (addDairyItem) {
                addDairyItem.addEventListener('click', function() {
                    createInventoryItem('dairy');
                });
            }
            
            const addFoodItem = document.getElementById('addFoodItem');
            if (addFoodItem) {
                addFoodItem.addEventListener('click', function() {
                    createInventoryItem('food');
                });
            }
            
            const addSupplyItem = document.getElementById('addSupplyItem');
            if (addSupplyItem) {
                addSupplyItem.addEventListener('click', function() {
                    createInventoryItem('supplies');
                });
            }
            
            // Event delegation for dynamically created inventory items
            document.addEventListener('click', function(e) {
                // Handle Edit buttons
                if (e.target.classList.contains('edit-inventory-btn')) {
                    const inventoryItem = e.target.closest('.inventory-item');
                    if (inventoryItem) {
                        const inventoryId = parseInt(inventoryItem.dataset.inventoryId);
                        editInventory(inventoryId);
                    }
                }
                
                // Handle Delete buttons
                if (e.target.classList.contains('delete-inventory-btn')) {
                    const inventoryItem = e.target.closest('.inventory-item');
                    if (inventoryItem) {
                        const inventoryId = parseInt(inventoryItem.dataset.inventoryId);
                        if (confirm('Are you sure you want to delete this inventory item?')) {
                            deleteInventoryItem(inventoryId);
                        }
                    }
                }
            });
        }

        // Function to create a new inventory update
        function createInventoryUpdate() {
            // Generate a new ID
            const newId = staffData.inventoryUpdates.length > 0 ? Math.max(...staffData.inventoryUpdates.map(u => u.id)) + 1 : 1;
            
            // Create a new inventory update with default values
            const today = new Date().toISOString().split('T')[0];
            const currentTime = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            // Try to pre-fill with an existing inventory item
            let defaultItem = "New Item";
            let defaultChange = "+0 units";
            let defaultLevel = "Medium";
            
            if (staffData.inventory.length > 0) {
                const firstItem = staffData.inventory[0];
                defaultItem = firstItem.name;
                defaultChange = `+1 ${firstItem.unit}`;
                defaultLevel = firstItem.level.charAt(0).toUpperCase() + firstItem.level.slice(1);
            }
            
            const newUpdate = {
                id: newId,
                item: defaultItem,
                updatedBy: "Supervisor",
                date: today,
                time: currentTime,
                change: defaultChange,
                newLevel: defaultLevel
            };
            
            staffData.inventoryUpdates.push(newUpdate);
            currentEditing.inventoryUpdate = newId;
            
            // Note: This modal doesn't exist in the HTML, so we'll just show a notification
            showNotification('Create inventory update functionality coming soon!', 'info');
        }

        // Function to create new task
        function createNewTask() {
            // Generate a new ID
            const newId = staffData.tasks.length > 0 ? Math.max(...staffData.tasks.map(t => t.id)) + 1 : 1;
            
            // Create a new task with default values
            const newTask = {
                id: newId,
                title: "New Task",
                assigneeId: staffData.employees.length > 0 ? staffData.employees[0].id : 1,
                dueDate: new Date().toISOString().split('T')[0],
                dueTime: "12:00",
                completed: false
            };
            
            staffData.tasks.push(newTask);
            currentEditing.task = newId;
            
            // Update the modal
            document.getElementById('editTaskTitle').textContent = 'Create New Task';
            document.getElementById('taskTitleInput').value = newTask.title;
            document.getElementById('taskAssignee').value = newTask.assigneeId;
            document.getElementById('taskDueDate').value = newTask.dueDate;
            document.getElementById('taskDueTime').value = newTask.dueTime;
            document.getElementById('taskCompleted').checked = newTask.completed;
            
            // Show the modal
            document.getElementById('editTaskModal').style.display = 'block';
        }

        // Function to create new schedule
        function createNewSchedule() {
            currentEditing.employee = null;
            currentEditing.day = null;
            
            document.getElementById('editScheduleTitle').textContent = 'Create New Schedule';
            
            // Show dropdowns for employee and day selection
            document.getElementById('employeeDisplayGroup').style.display = 'none';
            document.getElementById('employeeSelectGroup').style.display = 'block';
            document.getElementById('dayDisplayGroup').style.display = 'none';
            document.getElementById('daySelectGroup').style.display = 'block';
            
            // Clear the inputs
            document.getElementById('shiftStart').value = "09:00";
            document.getElementById('shiftEnd').value = "17:00";
            
            document.getElementById('editScheduleModal').style.display = 'block';
        }

        // Save schedule
        function saveSchedule() {
            if (currentEditing.employee && currentEditing.day) {
                // Editing existing schedule
                const employeeId = parseInt(currentEditing.employee);
                const day = currentEditing.day;
                const start = document.getElementById('shiftStart').value;
                const end = document.getElementById('shiftEnd').value;
                
                if (!employeeId || !day) return;
                
                // Find existing schedule
                const existingIndex = staffData.schedules.findIndex(s => 
                    s.employeeId === employeeId && s.day === day
                );
                
                if (existingIndex !== -1) {
                    // Update existing schedule
                    staffData.schedules[existingIndex].start = start;
                    staffData.schedules[existingIndex].end = end;
                } else {
                    // Create new schedule
                    staffData.schedules.push({
                        employeeId: employeeId,
                        day: day,
                        start: start,
                        end: end
                    });
                }
                
                // Save to localStorage
                saveSupervisorData();
                
                // Re-render the calendar to reflect changes
                renderCalendar();
                updateStaffDashboard();
                renderTodaySchedule();
                
                document.getElementById('editScheduleModal').style.display = 'none';
                showNotification('Schedule updated successfully!', 'success');
            } else {
                // Creating new schedule
                saveNewSchedule();
            }
        }

        // Save new schedule
        function saveNewSchedule() {
            const employeeId = parseInt(document.getElementById('employeeSelect').value);
            const day = document.getElementById('daySelect').value;
            const start = document.getElementById('shiftStart').value;
            const end = document.getElementById('shiftEnd').value;
            
            if (!employeeId || !day) {
                showNotification('Please select both employee and day', 'warning');
                return;
            }
            
            // Check if schedule already exists
            const existingIndex = staffData.schedules.findIndex(s => 
                s.employeeId === employeeId && s.day === day
            );
            
            if (existingIndex !== -1) {
                if (!confirm('A schedule already exists for this employee on the selected day. Overwrite?')) {
                    return;
                }
                // Update existing schedule
                staffData.schedules[existingIndex].start = start;
                staffData.schedules[existingIndex].end = end;
            } else {
                // Create new schedule
                staffData.schedules.push({
                    employeeId: employeeId,
                    day: day,
                    start: start,
                    end: end
                });
            }
            
            // Save to localStorage
            saveSupervisorData();
            
            // Re-render the calendar to reflect changes
                renderCalendar();
                updateStaffDashboard();
                renderTodaySchedule();
                
                document.getElementById('editScheduleModal').style.display = 'none';
                showNotification('Schedule created successfully!', 'success');
        }

        // Save task
        function saveTask() {
            const taskId = currentEditing.task;
            
            if (taskId) {
                let task = staffData.tasks.find(t => t.id === taskId);
                
                if (!task) {
                    // Create new task
                    task = {
                        id: taskId,
                        title: "",
                        assigneeId: 1,
                        dueDate: "",
                        dueTime: "",
                        completed: false
                    };
                    staffData.tasks.push(task);
                }
                
                // Update task properties
                task.title = document.getElementById('taskTitleInput').value;
                task.assigneeId = parseInt(document.getElementById('taskAssignee').value);
                task.dueDate = document.getElementById('taskDueDate').value;
                task.dueTime = document.getElementById('taskDueTime').value;
                task.completed = document.getElementById('taskCompleted').checked;
                
                // Re-render tasks
                renderTasks();
                
                // Save to localStorage
                saveSupervisorData();
                
                // Close modal
                document.getElementById('editTaskModal').style.display = 'none';
                showNotification('Task saved successfully!', 'success');
            }
        }

        // Enhanced save inventory function with Maximum Stock Level
        function saveInventory() {
            const inventoryId = currentEditing.inventory;
            if (!inventoryId) return;
            
            const item = staffData.inventory.find(i => i.id === inventoryId);
            if (!item) return;
            
            // Store old values for comparison
            const oldStock = item.stock;
            
            // Update item properties
            item.name = document.getElementById('inventoryItem').value;
            item.category = document.getElementById('inventoryCategory').value;
            item.unit = document.getElementById('inventoryUnit').value;
            item.stock = parseFloat(document.getElementById('inventoryQuantity').value) || 0;
            item.maxLevel = parseFloat(document.getElementById('inventoryMaximumStock').value) || 0;
            item.minLevel = parseFloat(document.getElementById('inventoryThreshold').value) || 0;
            item.lastUpdated = new Date().toISOString().split('T')[0];
            
            // Calculate and update status
            updateInventoryStatusDisplay(item);
            
            // Save to localStorage
            saveInventoryToLocalStorage();
            
            // Create inventory update record if stock changed
            if (oldStock !== item.stock) {
                createInventoryUpdateRecord(item, oldStock);
            }
            
            // Update displays
            renderInventory();
            
            document.getElementById('editInventoryModal').style.display = 'none';
            showNotification('Inventory updated successfully!', 'success');
        }

        function createInventoryUpdateRecord(item, oldStock, note = null) {
            const change = item.stock - oldStock;
            const changeString = change >= 0 ? `+${change}` : `${change}`;
            
            const newUpdate = {
                id: staffData.inventoryUpdates.length > 0 ? 
                    Math.max(...staffData.inventoryUpdates.map(u => u.id)) + 1 : 1,
                item: item.name,
                updatedBy: "Supervisor",
                date: new Date().toISOString().split('T')[0],
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                change: `${changeString} ${item.unit}`,
                newLevel: item.level.charAt(0).toUpperCase() + item.level.slice(1)
            };
            
            if (note) {
                newUpdate.notes = note;
            }
            
            staffData.inventoryUpdates.push(newUpdate);
            renderInventoryUpdates();
            saveSupervisorData();
        }

        function saveInventoryToLocalStorage() {
            localStorage.setItem('bistroInventory', JSON.stringify(staffData.inventory));
        }

        // Save inventory audit
        function saveInventoryAudit() {
            const auditId = currentEditing.inventoryAudit;
            const auditDate = document.getElementById('auditDate').value;
            const auditTime = document.getElementById('auditTime').value;
            const auditAuditor = document.getElementById('auditAuditor').value;
            const auditNotes = document.getElementById('auditNotes').value;
            
            // Collect audit items
            const auditItems = [];
            document.querySelectorAll('.audit-item-row').forEach(row => {
                const itemSelect = row.querySelector('.audit-item-select');
                const expectedInput = row.querySelector('.audit-expected');
                const actualInput = row.querySelector('.audit-actual');
                const discrepancyInput = row.querySelector('.audit-discrepancy');
                const notesInput = row.querySelector('.audit-item-notes');
                
                if (itemSelect && itemSelect.value) {
                    const inventoryItem = staffData.inventory.find(i => i.id == itemSelect.value);
                    auditItems.push({
                        itemId: parseInt(itemSelect.value),
                        itemName: inventoryItem ? inventoryItem.name : 'Unknown Item',
                        expected: parseFloat(expectedInput.value) || 0,
                        actual: parseFloat(actualInput.value) || 0,
                        discrepancy: parseFloat(discrepancyInput.value) || 0,
                        notes: notesInput.value || ''
                    });
                }
            });
            
            // Calculate summary
            const totalItems = auditItems.length;
            const itemsChecked = auditItems.length;
            const discrepancies = auditItems.filter(item => item.discrepancy !== 0).length;
            const accuracyRate = itemsChecked > 0 ? 
                `${((itemsChecked - discrepancies) / itemsChecked * 100).toFixed(1)}%` : 
                '100%';
            
            let audit;
            
            if (auditId) {
                // Update existing audit
                audit = staffData.inventoryAudits.find(a => a.id === auditId);
                if (audit) {
                    audit.date = auditDate;
                    audit.time = auditTime;
                    audit.auditor = auditAuditor;
                    audit.notes = auditNotes;
                    audit.items = auditItems;
                    audit.totalItems = totalItems;
                    audit.itemsChecked = itemsChecked;
                    audit.discrepancies = discrepancies;
                    audit.accuracyRate = accuracyRate;
                }
            } else {
                // Create new audit
                const newId = staffData.inventoryAudits.length > 0 ? 
                    Math.max(...staffData.inventoryAudits.map(a => a.id)) + 1 : 1;
                
                audit = {
                    id: newId,
                    date: auditDate,
                    time: auditTime,
                    auditor: auditAuditor,
                    notes: auditNotes,
                    items: auditItems,
                    status: 'In Progress',
                    totalItems: totalItems,
                    itemsChecked: itemsChecked,
                    discrepancies: discrepancies,
                    accuracyRate: accuracyRate
                };
                
                staffData.inventoryAudits.push(audit);
            }
            
            // Save to localStorage
            saveAuditsToLocalStorage();
            
            // Update UI
            renderInventoryAudits();
            
            // Close modal
            document.getElementById('inventoryAuditModal').style.display = 'none';
            
            showNotification(`Audit ${auditId ? 'updated' : 'created'} successfully!`, 'success');
        }

        // Complete inventory audit
        function completeInventoryAudit(audit) {
            if (!audit) return;
            
            // Update inventory based on audit discrepancies
            if (audit.items && audit.items.length > 0) {
                audit.items.forEach(auditItem => {
                    const inventoryItem = staffData.inventory.find(i => i.id === auditItem.itemId);
                    if (inventoryItem && auditItem.discrepancy !== 0) {
                        // Update inventory to match actual count
                        inventoryItem.stock = auditItem.actual;
                        inventoryItem.lastUpdated = new Date().toISOString().split('T')[0];
                        
                        // Create inventory update record
                        createInventoryUpdateRecord(
                            inventoryItem, 
                            inventoryItem.stock - auditItem.discrepancy, 
                            `Adjusted based on audit #${audit.id}`
                        );
                    }
                });
                
                // Re-render inventory
                renderInventory();
            }
            
            // Update audit status
            audit.status = 'Completed';
            
            // Save to localStorage
            saveAuditsToLocalStorage();
            
            // Update UI
            renderInventoryAudits();
            
            showNotification(`Audit #${audit.id} completed and inventory updated!`, 'success');
        }

        // Delete inventory audit
        function deleteInventoryAudit(auditId) {
            if (!auditId) return;
            
            if (confirm('Are you sure you want to delete this audit? This action cannot be undone.')) {
                staffData.inventoryAudits = staffData.inventoryAudits.filter(a => a.id !== auditId);
                
                // Save to localStorage
                saveAuditsToLocalStorage();
                
                // Update UI
                renderInventoryAudits();
                
                // Close modal if open
                document.getElementById('inventoryAuditModal').style.display = 'none';
                
                showNotification('Audit deleted successfully!', 'success');
            }
        }

        // Save audits to localStorage
        function saveAuditsToLocalStorage() {
            localStorage.setItem('bistroInventoryAudits', JSON.stringify(staffData.inventoryAudits));
        }

        // Save supervisor data to localStorage
        function saveSupervisorData() {
            // Save each component individually for reliability
            localStorage.setItem('supervisorEmployees', JSON.stringify(staffData.employees));
            localStorage.setItem('supervisorSchedules', JSON.stringify(staffData.schedules));
            localStorage.setItem('supervisorTimeClock', JSON.stringify(staffData.timeClock));
            localStorage.setItem('supervisorTasks', JSON.stringify(staffData.tasks));
            localStorage.setItem('supervisorInventoryUpdates', JSON.stringify(staffData.inventoryUpdates));
            
            // Also save the combined data
            localStorage.setItem('coffeeShopStaffData', JSON.stringify(staffData));
            
            console.log('All supervisor data saved to localStorage');
        }

        // Sync data to admin system
        function syncToAdminSystem() {
            // Save current data for admin system to access
            localStorage.setItem('coffeeShopStaffData', JSON.stringify(staffData));
            
            // Also save individual components for easier access
            localStorage.setItem('bistroSupervisorTasks', JSON.stringify(staffData.tasks));
            localStorage.setItem('bistroSupervisorSchedules', JSON.stringify(staffData.schedules));
            localStorage.setItem('bistroSupervisorTimeClock', JSON.stringify(staffData.timeClock));
            
            showNotification('Data synced to admin system', 'success');
        }

        // Sync employees from admin system
        function syncEmployeesFromAdmin(bistroEmployees) {
            if (!bistroEmployees || !Array.isArray(bistroEmployees)) return;
            
            console.log('Syncing employees from admin system:', bistroEmployees.length);
            
            // Update supervisor employees with admin data
            staffData.employees = bistroEmployees.map(emp => ({
                id: emp.id,
                name: emp.name,
                role: emp.position,
                avatar: emp.avatar || getInitials(emp.name)
            }));
            
            // Remove schedules for employees that no longer exist
            const adminEmployeeIds = bistroEmployees.map(emp => emp.id);
            staffData.schedules = staffData.schedules.filter(schedule => 
                adminEmployeeIds.includes(schedule.employeeId)
            );
            
            // Remove time clock entries for employees that no longer exist
            staffData.timeClock = staffData.timeClock.filter(entry => 
                adminEmployeeIds.includes(entry.employeeId)
            );
            
            // Update tasks to unassign deleted employees
            staffData.tasks = staffData.tasks.map(task => {
                if (task.assigneeId && !adminEmployeeIds.includes(task.assigneeId)) {
                    return {...task, assigneeId: null};
                }
                return task;
            });
            
            // Save updated data
            saveSupervisorData();
            
            // Update UI
            updateDashboardStaffList();
            renderCalendar();
            populateEmployeeSelects();
            renderTimeClock();
            renderTasks();
            
            showNotification(`${bistroEmployees.length} employees synced from admin system`, 'success');
        }

        // Delete schedule
        function deleteSchedule() {
            const employeeId = currentEditing.employee;
            const day = currentEditing.day;
            
            if (!employeeId || !day) return;
            
            if (confirm('Are you sure you want to delete this schedule?')) {
                // Remove from data
                staffData.schedules = staffData.schedules.filter(s => 
                    !(s.employeeId === parseInt(employeeId) && s.day === day)
                );

                // Save to localStorage
                saveSupervisorData();
                
                // Re-render the calendar to reflect changes
                renderCalendar();
                updateStaffDashboard();
                renderTodaySchedule();
                
                document.getElementById('editScheduleModal').style.display = 'none';
                showNotification('Schedule deleted successfully!', 'success');
            }
        }

        // Delete task
        function deleteTask() {
            const taskId = currentEditing.task;
            if (!taskId) return;
            
            if (confirm('Are you sure you want to delete this task?')) {
                staffData.tasks = staffData.tasks.filter(t => t.id !== taskId);
                
                renderTasks();
                saveSupervisorData();
                document.getElementById('editTaskModal').style.display = 'none';
                showNotification('Task deleted successfully!', 'success');
            }
        }

        // Delete inventory
        function deleteInventory() {
            const inventoryId = currentEditing.inventory;
            if (!inventoryId) return;
            
            if (confirm('Are you sure you want to delete this inventory item?')) {
                staffData.inventory = staffData.inventory.filter(i => i.id !== inventoryId);
                
                renderInventory();
                updateInventoryStats();
                updateInventoryAlerts();
                saveInventoryToLocalStorage();
                document.getElementById('editInventoryModal').style.display = 'none';
                showNotification('Inventory item deleted successfully!', 'success');
            }
        }

        // Edit staff name
        function editStaffName(employeeId) {
            const employee = staffData.employees.find(emp => emp.id === employeeId);
            if (!employee) return;
            
            const headerCell = document.querySelector(`.calendar-day.header .employee-name[data-employee-id="${employeeId}"]`);
            if (!headerCell) return;
            
            // Store the original name
            const originalName = employee.name;
            
            // Create input field
            const input = document.createElement('input');
            input.type = 'text';
            input.value = employee.name;
            input.className = 'form-control';
            input.style.border = '1px solid var(--primary-main)';
            input.style.padding = '0.25rem';
            
            // Replace text with input
            headerCell.textContent = '';
            headerCell.appendChild(input);
            input.focus();
            
            // Select all text for easier editing
            input.select();
            
            // Save on Enter key or blur
            const saveName = function() {
                const newName = input.value.trim();
                if (newName && newName !== originalName) {
                    // Update the employee name
                    employee.name = newName;
                    
                    // Update the avatar initials
                    const newInitials = getInitials(newName);
                    employee.avatar = newInitials;
                    
                    // Update all instances of this employee's name
                    updateEmployeeNameInUI(employeeId, newName, newInitials);
                    
                    // Save to localStorage
                    saveSupervisorData();
                    
                    showNotification(`Employee name updated to ${newName}`, 'success');
                } else {
                    // Revert to original name if empty or unchanged
                    headerCell.textContent = originalName;
                }
            };
            
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveName();
                }
            });
            
            input.addEventListener('blur', saveName);
        }

        // Edit staff role
        function editStaffRole(employeeId) {
            const employee = staffData.employees.find(emp => emp.id === employeeId);
            if (!employee) return;
            
            const roleCell = document.querySelector(`.calendar-day.header .employee-role[data-employee-id="${employeeId}"]`);
            if (!roleCell) return;
            
            // Store the original role
            const originalRole = employee.role;
            
            // Create input field
            const input = document.createElement('input');
            input.type = 'text';
            input.value = employee.role;
            input.className = 'form-control';
            input.style.border = '1px solid var(--info)';
            input.style.padding = '0.25rem';
            input.style.fontSize = '0.8rem';
            
            // Replace text with input
            roleCell.textContent = '';
            roleCell.appendChild(input);
            input.focus();
            
            // Select all text for easier editing
            input.select();
            
            // Save on Enter key or blur
            const saveRole = function() {
                const newRole = input.value.trim();
                if (newRole && newRole !== originalRole) {
                    employee.role = newRole;
                    roleCell.textContent = newRole;
                    
                    // Update all instances of this employee's role
                    updateEmployeeRoleInUI(employeeId, newRole);
                    
                    // Save to localStorage
                    saveSupervisorData();
                    
                    showNotification(`Employee role updated to ${newRole}`, 'success');
                } else {
                    roleCell.textContent = originalRole;
                }
            };
            
            input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    saveRole();
                }
            });
            
            input.addEventListener('blur', saveRole);
        }

        // Update the getInitials function to ensure it always returns proper initials:
        function getInitials(name) {
            if (!name || name.trim() === '') return 'NA';
            return name.split(' ')
                    .map(part => part[0])
                    .join('')
                    .toUpperCase()
                    .substring(0, 2);
        }

        // Helper function to update employee name throughout the UI
        function updateEmployeeNameInUI(employeeId, newName, newInitials) {
            // Update in staff list on main dashboard
            document.querySelectorAll('.staff-item').forEach(item => {
                const itemEmployeeId = parseInt(item.dataset.employeeId);
                if (itemEmployeeId === employeeId) {
                    item.querySelector('.staff-name').textContent = newName;
                    item.querySelector('.staff-avatar').textContent = newInitials;
                }
            });
            
            // Update in calendar headers
            document.querySelectorAll(`[data-employee-id="${employeeId}"]`).forEach(element => {
                if (element.classList.contains('employee-name')) {
                    element.textContent = newName;
                }
            });
            
            // Update employee dropdowns
            populateEmployeeSelects();
            
            // Re-render time clock to reflect name changes
            renderTimeClock();
        }

        // Helper function to update employee role throughout the UI
        function updateEmployeeRoleInUI(employeeId, newRole) {
            // Update in staff list on main dashboard
            document.querySelectorAll('.staff-role').forEach(element => {
                const employee = staffData.employees.find(e => e.id === employeeId);
                if (employee && element.textContent.includes(employee.role)) {
                    // Extract the shift time if it exists
                    const currentText = element.textContent;
                    const shiftMatch = currentText.match(/\(.*\)$/);
                    const shiftText = shiftMatch ? shiftMatch[0] : '';
                    
                    element.textContent = `${newRole} ${shiftText}`.trim();
                }
            });
            
            // Update in calendar headers
            document.querySelectorAll(`[data-employee-id="${employeeId}"]`).forEach(element => {
                if (element.classList.contains('employee-role')) {
                    element.textContent = newRole;
                }
            });
        }

        // Start real-time updates
        function startRealTimeUpdates() {
            // Check inventory levels every 30 seconds
            setInterval(() => {
                updateInventoryAlerts();
                updateInventoryStats();
            }, 30000);
            
            // Update date every minute
            setInterval(updateDate, 60000);
        }

        // Utility functions
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.backgroundColor = type === 'success' ? 'var(--success)' : 
                                               type === 'warning' ? 'var(--warning)' : 
                                               type === 'danger' ? 'var(--danger)' : 'var(--info)';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function formatDate(dateString) {
            if (!dateString) return 'No date';
            const date = new Date(dateString);
            const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString(undefined, options);
        }

        function formatTime(timeString) {
            if (!timeString) return '';
            if (timeString.includes('AM') || timeString.includes('PM')) {
                return timeString;
            }
            const [hours, minutes] = timeString.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes.padStart(2, '0')} ${ampm}`;
        }

        // Initialize date on load
        updateDate();
    </script>
</body>
</html>